! function(a) {
    "use strict";
    var b = a.HTMLCanvasElement && a.HTMLCanvasElement.prototype,
        c = a.Blob && function() {
            try {
                return Boolean(new Blob)
            } catch (a) {
                return !1
            }
        }(),
        d = c && a.Uint8Array && function() {
            try {
                return 100 === new Blob([new Uint8Array(100)]).size
            } catch (a) {
                return !1
            }
        }(),
        e = a.BlobBuilder || a.WebKitBlobBuilder || a.MozBlobBuilder || a.MSBlobBuilder,
        f = (c || e) && a.atob && a.ArrayBuffer && a.Uint8Array && function(a) {
            var b, f, g, h, i, j;
            for (b = a.split(",")[0].indexOf("base64") >= 0 ? atob(a.split(",")[1]) : decodeURIComponent(a.split(",")[1]), f = new ArrayBuffer(b.length), g = new Uint8Array(f), h = 0; h < b.length; h += 1) g[h] = b.charCodeAt(h);
            return i = a.split(",")[0].split(":")[1].split(";")[0], c ? new Blob([d ? g : f], {
                type: i
            }) : (j = new e, j.append(f), j.getBlob(i))
        };
    a.HTMLCanvasElement && !b.toBlob && (b.mozGetAsFile ? b.toBlob = function(a, c, d) {
        a(d && b.toDataURL && f ? f(this.toDataURL(c, d)) : this.mozGetAsFile("blob", c))
    } : b.toDataURL && f && (b.toBlob = function(a, b, c) {
        a(f(this.toDataURL(b, c)))
    })), a.dataURLtoBlob = f
}(window),
function(a, b) {
    "use strict";

    function c(a, b, c, d, e) {
        var f = {
            type: c.type || c,
            target: a,
            result: d
        };
        R(f, e), b(f)
    }

    function d(a) {
        return u && !!u.prototype["readAs" + a]
    }

    function e(a, e, f, g) {
        if (X.isBlob(a) && d(f)) {
            var h = new u;
            S(h, L, function j(b) {
                var d = b.type;
                "progress" == d ? c(a, e, b, b.target.result, {
                    loaded: b.loaded,
                    total: b.total
                }) : "loadend" == d ? (T(h, L, j), h = null) : c(a, e, b, b.target.result)
            });
            try {
                g ? h["readAs" + f](a, g) : h["readAs" + f](a)
            } catch (i) {
                c(a, e, "error", b, {
                    error: i.toString()
                })
            }
        } else c(a, e, "error", b, {
            error: "filreader_not_support_" + f
        })
    }

    function f(a, b) {
        if (!a.type && a.size % 4096 === 0 && a.size <= 102400000)
            if (u) try {
                var c = new u;
                U(c, L, function(a) {
                    var d = "error" != a.type;
                    b(d), d && c.abort()
                }), c.readAsDataURL(a)
            } catch (d) {
                b(!1)
            } else b(null);
            else b(!0)
    }

    function g(a) {
        var b;
        return a.getAsEntry ? b = a.getAsEntry() : a.webkitGetAsEntry && (b = a.webkitGetAsEntry()), b
    }

    function h(a, b) {
        if (a)
            if (a.isFile) a.file(function(c) {
                c.fullPath = a.fullPath, b(!1, [c])
            }, function(a) {
                b("FileError.code: " + a.code)
            });
            else if (a.isDirectory) {
            var c = a.createReader(),
                d = [];
            c.readEntries(function(a) {
                X.afor(a, function(a, c) {
                    h(c, function(c, e) {
                        c ? X.log(c) : d = d.concat(e), a ? a() : b(!1, d)
                    })
                })
            }, function(a) {
                b("directory_reader: " + a)
            })
        } else h(g(a), b);
        else b("invalid entry")
    }

    function i(a) {
        var b = {};
        return Q(a, function(a, c) {
            a && "object" == typeof a && void 0 === a.nodeType && (a = R({}, a)), b[c] = a
        }), b
    }

    function j(a) {
        return F.test(a && a.tagName)
    }

    function k(a) {
        return (a.originalEvent || a || "").dataTransfer || {}
    }

    function l(a) {
        var b;
        for (b in a)
            if (a.hasOwnProperty(b) && !(a[b] instanceof Object || "overlay" === b || "filter" === b)) return !0;
        return !1
    }
    var m = 1,
        n = function() {},
        o = a.document,
        p = o.doctype || {},
        q = a.navigator.userAgent,
        r = a.createObjectURL && a || a.URL && URL.revokeObjectURL && URL || a.webkitURL && webkitURL,
        s = a.Blob,
        t = a.File,
        u = a.FileReader,
        v = a.FormData,
        w = a.XMLHttpRequest,
        x = a.jQuery,
        y = !(!(t && u && (a.Uint8Array || v || w.prototype.sendAsBinary)) || /safari\//i.test(q) && !/chrome\//i.test(q) && /windows/i.test(q)),
        z = y && "withCredentials" in new w,
        A = y && !!s && !!(s.prototype.webkitSlice || s.prototype.mozSlice || s.prototype.slice),
        B = a.dataURLtoBlob,
        C = /img/i,
        D = /canvas/i,
        E = /img|canvas/i,
        F = /input/i,
        G = /^data:[^,]+,/,
        H = a.Math,
        I = function(b) {
            return b = new a.Number(H.pow(1024, b)), b.from = function(a) {
                return H.round(a * this)
            }, b
        },
        J = {},
        K = [],
        L = "abort progress error load loadend",
        M = "status statusText readyState response responseXML responseText responseBody".split(" "),
        N = "currentTarget",
        O = "preventDefault",
        P = function(a) {
            return a && "length" in a
        },
        Q = function(a, b, c) {
            if (a)
                if (P(a))
                    for (var d = 0, e = a.length; e > d; d++) d in a && b.call(c, a[d], d, a);
                else
                    for (var f in a) a.hasOwnProperty(f) && b.call(c, a[f], f, a)
        },
        R = function(a) {
            for (var b = arguments, c = 1, d = function(b, c) {
                    a[c] = b
                }; c < b.length; c++) Q(b[c], d);
            return a
        },
        S = function(a, b, c) {
            if (a) {
                var d = X.uid(a);
                J[d] || (J[d] = {});
                var e = u && a && a instanceof u;
                Q(b.split(/\s+/), function(b) {
                    x && !e ? x.event.add(a, b, c) : (J[d][b] || (J[d][b] = []), J[d][b].push(c), a.addEventListener ? a.addEventListener(b, c, !1) : a.attachEvent ? a.attachEvent("on" + b, c) : a["on" + b] = c)
                })
            }
        },
        T = function(a, b, c) {
            if (a) {
                var d = X.uid(a),
                    e = J[d] || {},
                    f = u && a && a instanceof u;
                Q(b.split(/\s+/), function(b) {
                    if (x && !f) x.event.remove(a, b, c);
                    else {
                        for (var d = e[b] || [], g = d.length; g--;)
                            if (d[g] === c) {
                                d.splice(g, 1);
                                break
                            }
                        a.addEventListener ? a.removeEventListener(b, c, !1) : a.detachEvent ? a.detachEvent("on" + b, c) : a["on" + b] = null
                    }
                })
            }
        },
        U = function(a, b, c) {
            S(a, b, function d(e) {
                T(a, b, d), c(e)
            })
        },
        V = function(b) {
            return b.target || (b.target = a.event && a.event.srcElement || o), 3 === b.target.nodeType && (b.target = b.target.parentNode), b
        },
        W = function(a) {
            var b = o.createElement("input");
            return b.setAttribute("type", "file"), a in b
        },
        X = {
            version: "2.0.4",
            cors: !1,
            html5: !0,
            media: !1,
            formData: !0,
            multiPassResize: !0,
            debug: !1,
            pingUrl: !1,
            multiFlash: !1,
            flashAbortTimeout: 0,
            withCredentials: !0,
            staticPath: "./dist/",
            flashUrl: 0,
            flashImageUrl: 0,
            postNameConcat: function(a, b) {
                return a + (null != b ? "[" + b + "]" : "")
            },
            ext2mime: {
                jpg: "image/jpeg",
                tif: "image/tiff",
                txt: "text/plain"
            },
            accept: {
                "image/*": "art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd",
                "audio/*": "m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs",
                "video/*": "m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"
            },
            uploadRetry: 0,
            networkDownRetryTimeout: 5e3,
            chunkSize: 0,
            chunkUploadRetry: 0,
            chunkNetworkDownRetryTimeout: 2e3,
            KB: I(1),
            MB: I(2),
            GB: I(3),
            TB: I(4),
            EMPTY_PNG: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",
            expando: "fileapi" + (new Date).getTime(),
            uid: function(a) {
                return a ? a[X.expando] = a[X.expando] || X.uid() : (++m, X.expando + m)
            },
            log: function() {
                X.debug && a.console && console.log && (console.log.apply ? console.log.apply(console, arguments) : console.log([].join.call(arguments, " ")))
            },
            newImage: function(a, b) {
                var c = o.createElement("img");
                return b && X.event.one(c, "error load", function(a) {
                    b("error" == a.type, c), c = null
                }), c.src = a, c
            },
            getXHR: function() {
                var b;
                if (w) b = new w;
                else if (a.ActiveXObject) try {
                    b = new ActiveXObject("MSXML2.XMLHttp.3.0")
                } catch (c) {
                    b = new ActiveXObject("Microsoft.XMLHTTP")
                }
                return b
            },
            isArray: P,
            support: {
                dnd: z && "ondrop" in o.createElement("div"),
                cors: z,
                html5: y,
                chunked: A,
                dataURI: !0,
                accept: W("accept"),
                multiple: W("multiple")
            },
            event: {
                on: S,
                off: T,
                one: U,
                fix: V
            },
            throttle: function(b, c) {
                var d, e;
                return function() {
                    e = arguments, d || (b.apply(a, e), d = setTimeout(function() {
                        d = 0, b.apply(a, e)
                    }, c))
                }
            },
            F: function() {},
            parseJSON: function(b) {
                var c;
                return c = a.JSON && JSON.parse ? JSON.parse(b) : new Function("return (" + b.replace(/([\r\n])/g, "\\$1") + ");")()
            },
            trim: function(a) {
                return a = String(a), a.trim ? a.trim() : a.replace(/^\s+|\s+$/g, "")
            },
            defer: function() {
                var a, c, d = [],
                    e = {
                        resolve: function(b, f) {
                            for (e.resolve = n, c = b || !1, a = f; f = d.shift();) f(c, a)
                        },
                        then: function(e) {
                            c !== b ? e(c, a) : d.push(e)
                        }
                    };
                return e
            },
            queue: function(a) {
                var b = 0,
                    c = 0,
                    d = !1,
                    e = !1,
                    f = {
                        inc: function() {
                            c++
                        },
                        next: function() {
                            b++, setTimeout(f.check, 0)
                        },
                        check: function() {
                            b >= c && !d && f.end()
                        },
                        isFail: function() {
                            return d
                        },
                        fail: function() {
                            !d && a(d = !0)
                        },
                        end: function() {
                            e || (e = !0, a())
                        }
                    };
                return f
            },
            each: Q,
            afor: function(a, b) {
                var c = 0,
                    d = a.length;
                P(a) && d-- ? ! function e() {
                    b(d != c && e, a[c], c++)
                }() : b(!1)
            },
            extend: R,
            isFile: function(a) {
                return y && a && a instanceof t
            },
            isBlob: function(a) {
                return y && a && a instanceof s
            },
            isCanvas: function(a) {
                return a && D.test(a.nodeName)
            },
            getFilesFilter: function(a) {
                return a = "string" == typeof a ? a : a.getAttribute && a.getAttribute("accept") || "", a ? new RegExp("(" + a.replace(/\./g, "\\.").replace(/,/g, "|") + ")$", "i") : /./
            },
            readAsDataURL: function(a, b) {
                X.isCanvas(a) ? c(a, b, "load", X.toDataURL(a)) : e(a, b, "DataURL")
            },
            readAsBinaryString: function(a, b) {
                d("BinaryString") ? e(a, b, "BinaryString") : e(a, function(a) {
                    if ("load" == a.type) try {
                        a.result = X.toBinaryString(a.result)
                    } catch (c) {
                        a.type = "error", a.message = c.toString()
                    }
                    b(a)
                }, "DataURL")
            },
            readAsArrayBuffer: function(a, b) {
                e(a, b, "ArrayBuffer")
            },
            readAsText: function(a, b, c) {
                c || (c = b, b = "utf-8"), e(a, c, "Text", b)
            },
            toDataURL: function(a, b) {
                return "string" == typeof a ? a : a.toDataURL ? a.toDataURL(b || "image/png") : void 0
            },
            toBinaryString: function(b) {
                return a.atob(X.toDataURL(b).replace(G, ""))
            },
            readAsImage: function(a, d, e) {
                if (X.isFile(a))
                    if (r) {
                        var f = r.createObjectURL(a);
                        f === b ? c(a, d, "error") : X.readAsImage(f, d, e)
                    } else X.readAsDataURL(a, function(b) {
                        "load" == b.type ? X.readAsImage(b.result, d, e) : (e || "error" == b.type) && c(a, d, b, null, {
                            loaded: b.loaded,
                            total: b.total
                        })
                    });
                else if (X.isCanvas(a)) c(a, d, "load", a);
                else if (C.test(a.nodeName))
                    if (a.complete) c(a, d, "load", a);
                    else {
                        var g = "error abort load";
                        U(a, g, function i(b) {
                            "load" == b.type && r && r.revokeObjectURL(a.src), T(a, g, i), c(a, d, b, a)
                        })
                    } else if (a.iframe) c(a, d, {
                    type: "error"
                });
                else {
                    var h = X.newImage(a.dataURL || a);
                    X.readAsImage(h, d, e)
                }
            },
            checkFileObj: function(a) {
                var b = {},
                    c = X.accept;
                return "object" == typeof a ? b = a : b.name = (a + "").split(/\\|\//g).pop(), null == b.type && (b.type = b.name.split(".").pop()), Q(c, function(a, c) {
                    a = new RegExp(a.replace(/\s/g, "|"), "i"), (a.test(b.type) || X.ext2mime[b.type]) && (b.type = X.ext2mime[b.type] || c.split("/")[0] + "/" + b.type)
                }), b
            },
            getDropFiles: function(a, b) {
                var c = [],
                    d = k(a),
                    e = P(d.items) && d.items[0] && g(d.items[0]),
                    i = X.queue(function() {
                        b(c)
                    });
                Q((e ? d.items : d.files) || [], function(a) {
                    i.inc();
                    try {
                        e ? h(a, function(a, b) {
                            a ? X.log("[err] getDropFiles:", a) : c.push.apply(c, b), i.next()
                        }) : f(a, function(b) {
                            b && c.push(a), i.next()
                        })
                    } catch (b) {
                        i.next(), X.log("[err] getDropFiles: ", b)
                    }
                }), i.check()
            },
            getFiles: function(a, b, c) {
                var d = [];
                return c ? (X.filterFiles(X.getFiles(a), b, c), null) : (a.jquery && (a.each(function() {
                    d = d.concat(X.getFiles(this))
                }), a = d, d = []), "string" == typeof b && (b = X.getFilesFilter(b)), a.originalEvent ? a = V(a.originalEvent) : a.srcElement && (a = V(a)), a.dataTransfer ? a = a.dataTransfer : a.target && (a = a.target), a.files ? (d = a.files, y || (d[0].blob = a, d[0].iframe = !0)) : !y && j(a) ? X.trim(a.value) && (d = [X.checkFileObj(a.value)], d[0].blob = a, d[0].iframe = !0) : P(a) && (d = a), X.filter(d, function(a) {
                    return !b || b.test(a.name)
                }))
            },
            getTotalSize: function(a) {
                for (var b = 0, c = a && a.length; c--;) b += a[c].size;
                return b
            },
            getInfo: function(a, b) {
                var c = {},
                    d = K.concat();
                X.isFile(a) ? ! function e() {
                    var f = d.shift();
                    f ? f.test(a.type) ? f(a, function(a, d) {
                        a ? b(a) : (R(c, d), e())
                    }) : e() : b(!1, c)
                }() : b("not_support_info", c)
            },
            addInfoReader: function(a, b) {
                b.test = function(b) {
                    return a.test(b)
                }, K.push(b)
            },
            filter: function(a, b) {
                for (var c, d = [], e = 0, f = a.length; f > e; e++) e in a && (c = a[e], b.call(c, c, e, a) && d.push(c));
                return d
            },
            filterFiles: function(a, b, c) {
                if (a.length) {
                    var d, e = a.concat(),
                        f = [],
                        g = [];
                    ! function h() {
                        e.length ? (d = e.shift(), X.getInfo(d, function(a, c) {
                            (b(d, a ? !1 : c) ? f : g).push(d), h()
                        })) : c(f, g)
                    }()
                } else c([], a)
            },
            upload: function(a) {
                a = R({
                    jsonp: "callback",
                    prepare: X.F,
                    beforeupload: X.F,
                    upload: X.F,
                    fileupload: X.F,
                    fileprogress: X.F,
                    filecomplete: X.F,
                    progress: X.F,
                    complete: X.F,
                    pause: X.F,
                    imageOriginal: !0,
                    chunkSize: X.chunkSize,
                    chunkUploadRetry: X.chunkUploadRetry,
                    uploadRetry: X.uploadRetry
                }, a), a.imageAutoOrientation && !a.imageTransform && (a.imageTransform = {
                    rotate: "auto"
                });
                var b, c = new X.XHR(a),
                    d = this._getFilesDataArray(a.files),
                    e = this,
                    f = 0,
                    g = 0,
                    h = !1;
                return Q(d, function(a) {
                    f += a.size
                }), c.files = [], Q(d, function(a) {
                    c.files.push(a.file)
                }), c.total = f, c.loaded = 0, c.filesLeft = d.length, a.beforeupload(c, a), b = function() {
                    var j = d.shift(),
                        k = j && j.file,
                        l = !1,
                        m = i(a);
                    if (c.filesLeft = d.length, k && k.name === X.expando && (k = null, X.log("[warn] FileAPI.upload() — called without files")), ("abort" != c.statusText || c.current) && j) {
                        if (h = !1, c.currentFile = k, k && a.prepare(k, m) === !1) return void b.call(e);
                        m.file = k, e._getFormData(m, j, function(h) {
                            g || a.upload(c, a);
                            var i = new X.XHR(R({}, m, {
                                upload: k ? function() {
                                    a.fileupload(k, i, m)
                                } : n,
                                progress: k ? function(b) {
                                    l || (l = b.loaded === b.total, a.fileprogress({
                                        type: "progress",
                                        total: j.total = b.total,
                                        loaded: j.loaded = b.loaded
                                    }, k, i, m), a.progress({
                                        type: "progress",
                                        total: f,
                                        loaded: c.loaded = g + j.size * (b.loaded / b.total) | 0
                                    }, k, i, m))
                                } : n,
                                complete: function(d) {
                                    Q(M, function(a) {
                                        c[a] = i[a]
                                    }), k && (j.total = j.total || j.size, j.loaded = j.total, this.progress(j), l = !0, g += j.size, c.loaded = g, a.filecomplete(d, i, k, m)), setTimeout(function() {
                                        b.call(e)
                                    }, 0)
                                }
                            }));
                            c.abort = function(a) {
                                a || (d.length = 0), this.current = a, i.abort()
                            }, i.send(h)
                        })
                    } else {
                        var o = 200 == c.status || 201 == c.status || 204 == c.status;
                        a.complete(o ? !1 : c.statusText || "error", c, a), h = !0
                    }
                }, setTimeout(b, 0), c.append = function(a, g) {
                    a = X._getFilesDataArray([].concat(a)), Q(a, function(a) {
                        f += a.size, c.files.push(a.file), g ? d.unshift(a) : d.push(a)
                    }), c.statusText = "", h && b.call(e)
                }, c.remove = function(a) {
                    for (var b, c = d.length; c--;) d[c].file == a && (b = d.splice(c, 1), f -= b.size);
                    return b
                }, c
            },
            _getFilesDataArray: function(a) {
                var b = [],
                    c = {};
                if (j(a)) {
                    var d = X.getFiles(a);
                    c[a.name || "file"] = null !== a.getAttribute("multiple") ? d : d[0]
                } else P(a) && j(a[0]) ? Q(a, function(a) {
                    c[a.name || "file"] = X.getFiles(a)
                }) : c = a;
                return Q(c, function e(a, c) {
                    P(a) ? Q(a, function(a) {
                        e(a, c)
                    }) : a && (a.name || a.image) && b.push({
                        name: c,
                        file: a,
                        size: a.size,
                        total: a.size,
                        loaded: 0
                    })
                }), b.length || b.push({
                    file: {
                        name: X.expando
                    }
                }), b
            },
            _getFormData: function(a, b, c) {
                var d = b.file,
                    e = b.name,
                    f = d.name,
                    g = d.type,
                    h = X.support.transform && a.imageTransform,
                    i = new X.Form,
                    j = X.queue(function() {
                        c(i)
                    }),
                    k = h && l(h),
                    m = X.postNameConcat;
                Q(a.data, function n(a, b) {
                        "object" == typeof a ? Q(a, function(a, c) {
                            n(a, m(b, c))
                        }) : i.append(b, a)
                    }),
                    function o(b) {
                        b.image ? (j.inc(), b.toData(function(a, b) {
                            f = f || (new Date).getTime() + ".png", o(b), j.next()
                        })) : X.Image && h && (/^image/.test(b.type) || E.test(b.nodeName)) ? (j.inc(), k && (h = [h]), X.Image.transform(b, h, a.imageAutoOrientation, function(c, d) {
                            if (k && !c) B || X.flashEngine || (i.multipart = !0), i.append(e, d[0], f, h[0].type || g);
                            else {
                                var l = 0;
                                c || Q(d, function(a, b) {
                                    B || X.flashEngine || (i.multipart = !0), h[b].postName || (l = 1), i.append(h[b].postName || m(e, b), a, f, h[b].type || g)
                                }), (c || a.imageOriginal) && i.append(m(e, l ? "original" : null), b, f, g)
                            }
                            j.next()
                        })) : f !== X.expando && i.append(e, b, f)
                    }(d), j.check()
            },
            reset: function(a, b) {
                var c, d;
                return x ? (d = x(a).clone(!0).insertBefore(a).val("")[0], b || x(a).remove()) : (c = a.parentNode, d = c.insertBefore(a.cloneNode(!0), a), d.value = "", b || c.removeChild(a), Q(J[X.uid(a)], function(b, c) {
                    Q(b, function(b) {
                        T(a, c, b), S(d, c, b)
                    })
                })), d
            },
            load: function(a, b) {
                var c = X.getXHR();
                return c ? (c.open("GET", a, !0), c.overrideMimeType && c.overrideMimeType("text/plain; charset=x-user-defined"), S(c, "progress", function(a) {
                    a.lengthComputable && b({
                        type: a.type,
                        loaded: a.loaded,
                        total: a.total
                    }, c)
                }), c.onreadystatechange = function() {
                    if (4 == c.readyState)
                        if (c.onreadystatechange = null, 200 == c.status) {
                            a = a.split("/");
                            var d = {
                                name: a[a.length - 1],
                                size: c.getResponseHeader("Content-Length"),
                                type: c.getResponseHeader("Content-Type")
                            };
                            d.dataURL = "data:" + d.type + ";base64," + X.encode64(c.responseBody || c.responseText), b({
                                type: "load",
                                result: d
                            }, c)
                        } else b({
                            type: "error"
                        }, c)
                }, c.send(null)) : b({
                    type: "error"
                }), c
            },
            encode64: function(a) {
                var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
                    c = "",
                    d = 0;
                for ("string" != typeof a && (a = String(a)); d < a.length;) {
                    var e, f, g = 255 & a.charCodeAt(d++),
                        h = 255 & a.charCodeAt(d++),
                        i = 255 & a.charCodeAt(d++),
                        j = g >> 2,
                        k = (3 & g) << 4 | h >> 4;
                    isNaN(h) ? e = f = 64 : (e = (15 & h) << 2 | i >> 6, f = isNaN(i) ? 64 : 63 & i), c += b.charAt(j) + b.charAt(k) + b.charAt(e) + b.charAt(f)
                }
                return c
            }
        };
    X.addInfoReader(/^image/, function(a, b) {
        if (!a.__dimensions) {
            var c = a.__dimensions = X.defer();
            X.readAsImage(a, function(a) {
                var b = a.target;
                c.resolve("load" == a.type ? !1 : "error", {
                    width: b.width,
                    height: b.height
                }), b.src = X.EMPTY_PNG, b = null
            })
        }
        a.__dimensions.then(b)
    }), X.event.dnd = function(a, b, c) {
        var d, e;
        c || (c = b, b = X.F), u ? (S(a, "dragenter dragleave dragover", function(a) {
            for (var c = k(a).types, f = c && c.length, g = !1; f--;)
                if (~c[f].indexOf("File")) {
                    a[O](), e !== a.type && (e = a.type, "dragleave" != e && b.call(a[N], !0, a), g = !0);
                    break
                }
            g && (clearTimeout(d), d = setTimeout(function() {
                b.call(a[N], "dragleave" != e, a)
            }, 50))
        }), S(a, "drop", function(a) {
            a[O](), e = 0, b.call(a[N], !1, a), X.getDropFiles(a, function(b) {
                c.call(a[N], b, a)
            })
        })) : X.log("Drag'n'Drop -- not supported")
    }, X.event.dnd.off = function(a, b, c) {
        T(a, "dragenter dragleave dragover", b), T(a, "drop", c)
    }, x && !x.fn.dnd && (x.fn.dnd = function(a, b) {
        return this.each(function() {
            X.event.dnd(this, a, b)
        })
    }, x.fn.offdnd = function(a, b) {
        return this.each(function() {
            X.event.dnd.off(this, a, b)
        })
    }), a.FileAPI = R(X, a.FileAPI), X.log("FileAPI: " + X.version), X.log("protocol: " + a.location.protocol), X.log("doctype: [" + p.name + "] " + p.publicId + " " + p.systemId), Q(o.getElementsByTagName("meta"), function(a) {
        /x-ua-compatible/i.test(a.getAttribute("http-equiv")) && X.log("meta.http-equiv: " + a.getAttribute("content"))
    }), X.flashUrl || (X.flashUrl = X.staticPath + "FileAPI.flash.swf"), X.flashImageUrl || (X.flashImageUrl = X.staticPath + "FileAPI.flash.image.swf"), X.flashWebcamUrl || (X.flashWebcamUrl = X.staticPath + "FileAPI.flash.camera.swf")
}(window, void 0),
function(a, b, c) {
    "use strict";

    function d(b) {
        if (b instanceof d) {
            var c = new d(b.file);
            return a.extend(c.matrix, b.matrix), c
        }
        return this instanceof d ? (this.file = b, this.size = b.size || 100, void(this.matrix = {
            sx: 0,
            sy: 0,
            sw: 0,
            sh: 0,
            dx: 0,
            dy: 0,
            dw: 0,
            dh: 0,
            resize: 0,
            deg: 0,
            quality: 1,
            filter: 0
        })) : new d(b)
    }
    var e = Math.min,
        f = Math.round,
        g = function() {
            return b.createElement("canvas")
        },
        h = !1,
        i = {
            8: 270,
            3: 180,
            6: 90,
            7: 270,
            4: 180,
            5: 90
        };
    try {
        h = g().toDataURL("image/png").indexOf("data:image/png") > -1
    } catch (j) {}
    d.prototype = {
        image: !0,
        constructor: d,
        set: function(b) {
            return a.extend(this.matrix, b), this
        },
        crop: function(a, b, d, e) {
            return d === c && (d = a, e = b, a = b = 0), this.set({
                sx: a,
                sy: b,
                sw: d,
                sh: e || d
            })
        },
        resize: function(a, b, c) {
            return /min|max/.test(b) && (c = b, b = a), this.set({
                dw: a,
                dh: b || a,
                resize: c
            })
        },
        preview: function(a, b) {
            return this.resize(a, b || a, "preview")
        },
        rotate: function(a) {
            return this.set({
                deg: a
            })
        },
        filter: function(a) {
            return this.set({
                filter: a
            })
        },
        overlay: function(a) {
            return this.set({
                overlay: a
            })
        },
        clone: function() {
            return new d(this)
        },
        _load: function(b, c) {
            var d = this;
            /img|video/i.test(b.nodeName) ? c.call(d, null, b) : a.readAsImage(b, function(a) {
                c.call(d, "load" != a.type, a.result)
            })
        },
        _apply: function(b, c) {
            var f, h = g(),
                i = this.getMatrix(b),
                j = h.getContext("2d"),
                k = b.videoWidth || b.width,
                l = b.videoHeight || b.height,
                m = i.deg,
                n = i.dw,
                o = i.dh,
                p = k,
                q = l,
                r = i.filter,
                s = b,
                t = i.overlay,
                u = a.queue(function() {
                    b.src = a.EMPTY_PNG, c(!1, h)
                }),
                v = a.renderImageToCanvas;
            for (m -= 360 * Math.floor(m / 360), b._type = this.file.type; i.multipass && e(p / n, q / o) > 2;) p = p / 2 + .5 | 0, q = q / 2 + .5 | 0, f = g(), f.width = p, f.height = q, s !== b ? (v(f, s, 0, 0, s.width, s.height, 0, 0, p, q), s = f) : (s = f, v(s, b, i.sx, i.sy, i.sw, i.sh, 0, 0, p, q), i.sx = i.sy = i.sw = i.sh = 0);
            h.width = m % 180 ? o : n, h.height = m % 180 ? n : o, h.type = i.type, h.quality = i.quality, j.rotate(m * Math.PI / 180), v(j.canvas, s, i.sx, i.sy, i.sw || s.width, i.sh || s.height, 180 == m || 270 == m ? -n : 0, 90 == m || 180 == m ? -o : 0, n, o), n = h.width, o = h.height, t && a.each([].concat(t), function(b) {
                u.inc();
                var c = new window.Image,
                    d = function() {
                        var e = 0 | b.x,
                            f = 0 | b.y,
                            g = b.w || c.width,
                            h = b.h || c.height,
                            i = b.rel;
                        e = 1 == i || 4 == i || 7 == i ? (n - g + e) / 2 : 2 == i || 5 == i || 8 == i ? n - (g + e) : e, f = 3 == i || 4 == i || 5 == i ? (o - h + f) / 2 : i >= 6 ? o - (h + f) : f, a.event.off(c, "error load abort", d);
                        try {
                            j.globalAlpha = b.opacity || 1, j.drawImage(c, e, f, g, h)
                        } catch (k) {}
                        u.next()
                    };
                a.event.on(c, "error load abort", d), c.src = b.src, c.complete && d()
            }), r && (u.inc(), d.applyFilter(h, r, u.next)), u.check()
        },
        getMatrix: function(b) {
            var c = a.extend({}, this.matrix),
                d = c.sw = c.sw || b.videoWidth || b.naturalWidth || b.width,
                g = c.sh = c.sh || b.videoHeight || b.naturalHeight || b.height,
                h = c.dw = c.dw || d,
                i = c.dh = c.dh || g,
                j = d / g,
                k = h / i,
                l = c.resize;
            if ("preview" == l) {
                if (h != d || i != g) {
                    var m, n;
                    k >= j ? (m = d, n = m / k) : (n = g, m = n * k), (m != d || n != g) && (c.sx = ~~((d - m) / 2), c.sy = ~~((g - n) / 2), d = m, g = n)
                }
            } else l && (d > h || g > i ? "min" == l ? (h = f(k > j ? e(d, h) : i * j), i = f(k > j ? h / j : e(g, i))) : (h = f(j >= k ? e(d, h) : i * j), i = f(j >= k ? h / j : e(g, i))) : (h = d, i = g));
            return c.sw = d, c.sh = g, c.dw = h, c.dh = i, c.multipass = a.multiPassResize, c
        },
        _trans: function(b) {
            this._load(this.file, function(c, d) {
                if (c) b(c);
                else try {
                    this._apply(d, b)
                } catch (c) {
                    a.log("[err] FileAPI.Image.fn._apply:", c), b(c)
                }
            })
        },
        get: function(b) {
            if (a.support.transform) {
                var c = this,
                    d = c.matrix;
                "auto" == d.deg ? a.getInfo(c.file, function(a, e) {
                    d.deg = i[e && e.exif && e.exif.Orientation] || 0, c._trans(b)
                }) : c._trans(b)
            } else b("not_support_transform");
            return this
        },
        toData: function(a) {
            return this.get(a)
        }
    }, d.exifOrientation = i, d.transform = function(b, e, f, g) {
        function h(h, i) {
            var j = {},
                k = a.queue(function(a) {
                    g(a, j)
                });
            h ? k.fail() : a.each(e, function(a, e) {
                if (!k.isFail()) {
                    var g = new d(i.nodeType ? i : b);
                    if ("function" == typeof a ? a(i, g) : a.width ? g[a.preview ? "preview" : "resize"](a.width, a.height, a.strategy) : a.maxWidth && (i.width > a.maxWidth || i.height > a.maxHeight) && g.resize(a.maxWidth, a.maxHeight, "max"), a.crop) {
                        var h = a.crop;
                        g.crop(0 | h.x, 0 | h.y, h.w || h.width, h.h || h.height)
                    }
                    a.rotate === c && f && (a.rotate = "auto"), g.set({
                        deg: a.rotate,
                        type: a.type || b.type || "image/png",
                        quality: a.quality || 1,
                        overlay: a.overlay,
                        filter: a.filter
                    }), k.inc(), g.toData(function(a, b) {
                        a ? k.fail() : (j[e] = b, k.next())
                    })
                }
            })
        }
        b.width ? h(!1, b) : a.getInfo(b, h)
    }, a.each(["TOP", "CENTER", "BOTTOM"], function(b, c) {
        a.each(["LEFT", "CENTER", "RIGHT"], function(a, e) {
            d[b + "_" + a] = 3 * c + e, d[a + "_" + b] = 3 * c + e
        })
    }), d.toCanvas = function(a) {
        var c = b.createElement("canvas");
        return c.width = a.videoWidth || a.width, c.height = a.videoHeight || a.height, c.getContext("2d").drawImage(a, 0, 0), c
    }, d.fromDataURL = function(b, c, d) {
        var e = a.newImage(b);
        a.extend(e, c), d(e)
    }, d.applyFilter = function(b, c, e) {
        "function" == typeof c ? c(b, e) : window.Caman && window.Caman("IMG" == b.tagName ? d.toCanvas(b) : b, function() {
            "string" == typeof c ? this[c]() : a.each(c, function(a, b) {
                this[b](a)
            }, this), this.render(e)
        })
    }, a.renderImageToCanvas = function(b, c, d, e, f, g, h, i, j, k) {
        try {
            return b.getContext("2d").drawImage(c, d, e, f, g, h, i, j, k)
        } catch (l) {
            throw a.log("renderImageToCanvas failed"), l
        }
    }, a.support.canvas = a.support.transform = h, a.Image = d
}(FileAPI, document),
function(a) {
    "use strict";
    a(FileAPI)
}(function(a) {
    "use strict";
    if (window.navigator && window.navigator.platform && /iP(hone|od|ad)/.test(window.navigator.platform)) {
        var b = a.renderImageToCanvas;
        a.detectSubsampling = function(a) {
            var b, c;
            return a.width * a.height > 1048576 ? (b = document.createElement("canvas"), b.width = b.height = 1, c = b.getContext("2d"), c.drawImage(a, -a.width + 1, 0), 0 === c.getImageData(0, 0, 1, 1).data[3]) : !1
        }, a.detectVerticalSquash = function(a, b) {
            var c, d, e, f, g, h = a.naturalHeight || a.height,
                i = document.createElement("canvas"),
                j = i.getContext("2d");
            for (b && (h /= 2), i.width = 1, i.height = h, j.drawImage(a, 0, 0), c = j.getImageData(0, 0, 1, h).data, d = 0, e = h, f = h; f > d;) g = c[4 * (f - 1) + 3], 0 === g ? e = f : d = f, f = e + d >> 1;
            return f / h || 1
        }, a.renderImageToCanvas = function(c, d, e, f, g, h, i, j, k, l) {
            if ("image/jpeg" === d._type) {
                var m, n, o, p, q = c.getContext("2d"),
                    r = document.createElement("canvas"),
                    s = 1024,
                    t = r.getContext("2d");
                if (r.width = s, r.height = s, q.save(), m = a.detectSubsampling(d), m && (e /= 2, f /= 2, g /= 2, h /= 2), n = a.detectVerticalSquash(d, m), m || 1 !== n) {
                    for (f *= n, k = Math.ceil(s * k / g), l = Math.ceil(s * l / h / n), j = 0, p = 0; h > p;) {
                        for (i = 0, o = 0; g > o;) t.clearRect(0, 0, s, s), t.drawImage(d, e, f, g, h, -o, -p, g, h), q.drawImage(r, 0, 0, s, s, i, j, k, l), o += s, i += k;
                        p += s, j += l
                    }
                    return q.restore(), c
                }
            }
            return b(c, d, e, f, g, h, i, j, k, l)
        }
    }
}),
function(a, b) {
    "use strict";

    function c(b, c, d) {
        var e = b.blob,
            f = b.file;
        if (f) {
            if (!e.toDataURL) return void a.readAsBinaryString(e, function(a) {
                "load" == a.type && c(b, a.result)
            });
            var g = {
                    "image/jpeg": ".jpe?g",
                    "image/png": ".png"
                },
                h = g[b.type] ? b.type : "image/png",
                i = g[h] || ".png",
                j = e.quality || 1;
            f.match(new RegExp(i + "$", "i")) || (f += i.replace("?", "")), b.file = f, b.type = h, !d && e.toBlob ? e.toBlob(function(a) {
                c(b, a)
            }, h, j) : c(b, a.toBinaryString(e.toDataURL(h, j)))
        } else c(b, e)
    }
    var d = b.document,
        e = b.FormData,
        f = function() {
            this.items = []
        },
        g = b.encodeURIComponent;
    f.prototype = {
        append: function(a, b, c, d) {
            this.items.push({
                name: a,
                blob: b && b.blob || (void 0 == b ? "" : b),
                file: b && (c || b.name),
                type: b && (d || b.type)
            })
        },
        each: function(a) {
            for (var b = 0, c = this.items.length; c > b; b++) a.call(this, this.items[b])
        },
        toData: function(b, c) {
            c._chunked = a.support.chunked && c.chunkSize > 0 && 1 == a.filter(this.items, function(a) {
                return a.file
            }).length, a.support.html5 ? a.formData && !this.multipart && e ? c._chunked ? (a.log("FileAPI.Form.toPlainData"), this.toPlainData(b)) : (a.log("FileAPI.Form.toFormData"), this.toFormData(b)) : (a.log("FileAPI.Form.toMultipartData"), this.toMultipartData(b)) : (a.log("FileAPI.Form.toHtmlData"), this.toHtmlData(b))
        },
        _to: function(b, c, d, e) {
            var f = a.queue(function() {
                c(b)
            });
            this.each(function(a) {
                d(a, b, f, e)
            }), f.check()
        },
        toHtmlData: function(b) {
            this._to(d.createDocumentFragment(), b, function(b, c) {
                var e, f = b.blob;
                b.file ? (a.reset(f, !0), f.name = b.name, c.appendChild(f)) : (e = d.createElement("input"), e.name = b.name, e.type = "hidden", e.value = f, c.appendChild(e))
            })
        },
        toPlainData: function(a) {
            this._to({}, a, function(a, b, d) {
                a.file && (b.type = a.file), a.blob.toBlob ? (d.inc(), c(a, function(a, c) {
                    b.name = a.name, b.file = c, b.size = c.length, b.type = a.type, d.next()
                })) : a.file ? (b.name = a.blob.name, b.file = a.blob, b.size = a.blob.size, b.type = a.type) : (b.params || (b.params = []), b.params.push(g(a.name) + "=" + g(a.blob))), b.start = -1, b.end = b.file && b.file.FileAPIReadPosition || -1, b.retry = 0
            })
        },
        toFormData: function(a) {
            this._to(new e, a, function(a, b, d) {
                a.blob && a.blob.toBlob ? (d.inc(), c(a, function(a, c) {
                    b.append(a.name, c, a.file), d.next()
                })) : a.file ? b.append(a.name, a.blob, a.file) : b.append(a.name, a.blob), a.file && b.append("_" + a.name, a.file)
            })
        },
        toMultipartData: function(b) {
            this._to([], b, function(a, b, d, e) {
                d.inc(), c(a, function(a, c) {
                    b.push("--_" + e + ('\r\nContent-Disposition: form-data; name="' + a.name + '"' + (a.file ? '; filename="' + g(a.file) + '"' : "") + (a.file ? "\r\nContent-Type: " + (a.type || "application/octet-stream") : "") + "\r\n\r\n" + (a.file ? c : g(c)) + "\r\n")), d.next()
                }, !0)
            }, a.expando)
        }
    }, a.Form = f
}(FileAPI, window),
function(a, b) {
    "use strict";
    var c = function() {},
        d = a.document,
        e = function(a) {
            this.uid = b.uid(), this.xhr = {
                abort: c,
                getResponseHeader: c,
                getAllResponseHeaders: c
            }, this.options = a
        },
        f = {
            "": 1,
            XML: 1,
            Text: 1,
            Body: 1
        };
    e.prototype = {
        status: 0,
        statusText: "",
        constructor: e,
        getResponseHeader: function(a) {
            return this.xhr.getResponseHeader(a)
        },
        getAllResponseHeaders: function() {
            return this.xhr.getAllResponseHeaders() || {}
        },
        end: function(d, e) {
            var f = this,
                g = f.options;
            f.end = f.abort = c, f.status = d, e && (f.statusText = e), b.log("xhr.end:", d, e), g.complete(200 == d || 201 == d ? !1 : f.statusText || "unknown", f), f.xhr && f.xhr.node && setTimeout(function() {
                var b = f.xhr.node;
                try {
                    b.parentNode.removeChild(b)
                } catch (c) {}
                try {
                    delete a[f.uid]
                } catch (c) {}
                a[f.uid] = f.xhr.node = null
            }, 9)
        },
        abort: function() {
            this.end(0, "abort"), this.xhr && (this.xhr.aborted = !0, this.xhr.abort())
        },
        send: function(a) {
            var b = this,
                c = this.options;
            a.toData(function(a) {
                c.upload(c, b), b._send.call(b, c, a)
            }, c)
        },
        _send: function(c, e) {
            var g, h = this,
                i = h.uid,
                j = c.url;
            if (b.log("XHR._send:", e), c.cache || (j += (~j.indexOf("?") ? "&" : "?") + b.uid()), e.nodeName) {
                var k = c.jsonp;
                j = j.replace(/([a-z]+)=(\?)/i, "$1=" + i), c.upload(c, h), g = d.createElement("div"), g.innerHTML = '<form target="' + i + '" action="' + j + '" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="' + i + '" src="javascript:false;"></iframe>' + (k && c.url.indexOf("=?") < 0 ? '<input value="' + i + '" name="' + k + '" type="hidden"/>' : "") + "</form>";
                var l = g.getElementsByTagName("form")[0],
                    m = g.getElementsByTagName("iframe")[0];
                l.appendChild(e), b.log(l.parentNode.innerHTML), d.body.appendChild(g), h.xhr.node = g;
                var n = function(a) {
                        if (~j.indexOf(a.origin)) try {
                            var c = b.parseJSON(a.data);
                            c.id == i && o(c.status, c.statusText, c.response)
                        } catch (d) {
                            o(0, d.message)
                        }
                    },
                    o = a[i] = function(c, d, e) {
                        h.readyState = 4, h.responseText = e, h.end(c, d), b.event.off(a, "message", n), a[i] = g = m = m.onload = null
                    };
                h.xhr.abort = function() {
                    try {
                        m.stop ? m.stop() : m.contentWindow.stop ? m.contentWindow.stop() : m.contentWindow.document.execCommand("Stop")
                    } catch (a) {}
                    o(0, "abort")
                }, b.event.on(a, "message", n), m.onload = function() {
                    try {
                        var a = m.contentWindow,
                            c = a.document,
                            d = a.result || b.parseJSON(c.body.innerHTML);
                        o(d.status, d.statusText, d.response)
                    } catch (e) {
                        b.log("[transport.onload]", e)
                    }
                }, h.readyState = 2, l.submit(), l = null
            } else {
                if (j = j.replace(/([a-z]+)=(\?)&?/i, ""), this.xhr && this.xhr.aborted) return void b.log("Error: already aborted");
                if (g = h.xhr = b.getXHR(), e.params && (j += (j.indexOf("?") < 0 ? "?" : "&") + e.params.join("&")), g.open("POST", j, !0), b.withCredentials && (g.withCredentials = "true"), c.headers && c.headers["X-Requested-With"] || g.setRequestHeader("X-Requested-With", "XMLHttpRequest"), b.each(c.headers, function(a, b) {
                        g.setRequestHeader(b, a)
                    }), c._chunked) {
                    g.upload && g.upload.addEventListener("progress", b.throttle(function(a) {
                        e.retry || c.progress({
                            type: a.type,
                            total: e.size,
                            loaded: e.start + a.loaded,
                            totalSize: e.size
                        }, h, c)
                    }, 100), !1), g.onreadystatechange = function() {
                        var a = parseInt(g.getResponseHeader("X-Last-Known-Byte"), 10);
                        if (h.status = g.status, h.statusText = g.statusText, h.readyState = g.readyState, 4 == g.readyState) {
                            for (var d in f) h["response" + d] = g["response" + d];
                            if (g.onreadystatechange = null, !g.status || g.status - 201 > 0)
                                if (b.log("Error: " + g.status), (!g.status && !g.aborted || 500 == g.status || 416 == g.status) && ++e.retry <= c.chunkUploadRetry) {
                                    var i = g.status ? 0 : b.chunkNetworkDownRetryTimeout;
                                    c.pause(e.file, c), b.log("X-Last-Known-Byte: " + a), a ? e.end = a : (e.end = e.start - 1, 416 == g.status && (e.end = e.end - c.chunkSize)), setTimeout(function() {
                                        h._send(c, e)
                                    }, i)
                                } else h.end(g.status);
                            else e.retry = 0, e.end == e.size - 1 ? h.end(g.status) : (b.log("X-Last-Known-Byte: " + a), a && (e.end = a), e.file.FileAPIReadPosition = e.end, setTimeout(function() {
                                h._send(c, e)
                            }, 0));
                            g = null
                        }
                    }, e.start = e.end + 1, e.end = Math.max(Math.min(e.start + c.chunkSize, e.size) - 1, e.start);
                    var p = e.file,
                        q = (p.slice || p.mozSlice || p.webkitSlice).call(p, e.start, e.end + 1);
                    e.size && !q.size ? setTimeout(function() {
                        h.end(-1)
                    }) : (g.setRequestHeader("Content-Range", "bytes " + e.start + "-" + e.end + "/" + e.size), g.setRequestHeader("Content-Disposition", "attachment; filename=" + encodeURIComponent(e.name)), g.setRequestHeader("Content-Type", e.type || "application/octet-stream"), g.send(q)), p = q = null
                } else if (g.upload && g.upload.addEventListener("progress", b.throttle(function(a) {
                        c.progress(a, h, c)
                    }, 100), !1), g.onreadystatechange = function() {
                        if (h.status = g.status, h.statusText = g.statusText, h.readyState = g.readyState, 4 == g.readyState) {
                            for (var a in f) h["response" + a] = g["response" + a];
                            if (g.onreadystatechange = null, !g.status || g.status > 201)
                                if (b.log("Error: " + g.status), (!g.status && !g.aborted || 500 == g.status) && (c.retry || 0) < c.uploadRetry) {
                                    c.retry = (c.retry || 0) + 1;
                                    var d = b.networkDownRetryTimeout;
                                    c.pause(c.file, c), setTimeout(function() {
                                        h._send(c, e)
                                    }, d)
                                } else h.end(g.status);
                            else h.end(g.status);
                            g = null
                        }
                    }, b.isArray(e)) {
                    g.setRequestHeader("Content-Type", "multipart/form-data; boundary=_" + b.expando);
                    var r = e.join("") + "--_" + b.expando + "--";
                    if (g.sendAsBinary) g.sendAsBinary(r);
                    else {
                        var s = Array.prototype.map.call(r, function(a) {
                            return 255 & a.charCodeAt(0)
                        });
                        g.send(new Uint8Array(s).buffer)
                    }
                } else g.send(e)
            }
        }
    }, b.XHR = e
}(window, FileAPI),
function(a, b) {
    "use strict";

    function c(a) {
        return a >= 0 ? a + "px" : a
    }

    function d(a) {
        var b, c = f.createElement("canvas"),
            d = !1;
        try {
            b = c.getContext("2d"), b.drawImage(a, 0, 0, 1, 1), d = 255 != b.getImageData(0, 0, 1, 1).data[4]
        } catch (e) {}
        return d
    }
    var e = a.URL || a.webkitURL,
        f = a.document,
        g = a.navigator,
        h = g.getUserMedia || g.webkitGetUserMedia || g.mozGetUserMedia || g.msGetUserMedia,
        i = !!h;
    b.support.media = i;
    var j = function(a) {
        this.video = a
    };
    j.prototype = {
        isActive: function() {
            return !!this._active
        },
        start: function(a) {
            var b, c, f = this,
                i = f.video,
                j = function(d) {
                    f._active = !d, clearTimeout(c), clearTimeout(b), a && a(d, f)
                };
            h.call(g, {
                video: !0
            }, function(a) {
                f.stream = a, i.src = e.createObjectURL(a), b = setInterval(function() {
                    d(i) && j(null)
                }, 1e3), c = setTimeout(function() {
                    j("timeout")
                }, 5e3), i.play()
            }, j)
        },
        stop: function() {
            try {
                this._active = !1, this.video.pause(), this.stream.stop()
            } catch (a) {}
        },
        shot: function() {
            return new k(this.video)
        }
    }, j.get = function(a) {
        return new j(a.firstChild)
    }, j.publish = function(d, e, g) {
        "function" == typeof e && (g = e, e = {}), e = b.extend({}, {
            width: "100%",
            height: "100%",
            start: !0
        }, e), d.jquery && (d = d[0]);
        var h = function(a) {
            if (a) g(a);
            else {
                var b = j.get(d);
                e.start ? b.start(g) : g(null, b)
            }
        };
        if (d.style.width = c(e.width), d.style.height = c(e.height), b.html5 && i) {
            var k = f.createElement("video");
            k.style.width = c(e.width), k.style.height = c(e.height), a.jQuery ? jQuery(d).empty() : d.innerHTML = "", d.appendChild(k), h()
        } else j.fallback(d, e, h)
    }, j.fallback = function(a, b, c) {
        c("not_support_camera")
    };
    var k = function(a) {
        var c = a.nodeName ? b.Image.toCanvas(a) : a,
            d = b.Image(c);
        return d.type = "image/png", d.width = c.width, d.height = c.height, d.size = c.width * c.height * 4, d
    };
    j.Shot = k, b.Camera = j
}(window, FileAPI),
function(a, b, c) {
    "use strict";
    var d = a.document,
        e = a.location,
        f = a.navigator,
        g = c.each;
    c.support.flash = function() {
        var b = f.mimeTypes,
            d = !1;
        if (f.plugins && "object" == typeof f.plugins["Shockwave Flash"]) d = f.plugins["Shockwave Flash"].description && !(b && b["application/x-shockwave-flash"] && !b["application/x-shockwave-flash"].enabledPlugin);
        else try {
            d = !(!a.ActiveXObject || !new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))
        } catch (g) {
            c.log("Flash -- does not supported.")
        }
        return d && /^file:/i.test(e) && c.log("[warn] Flash does not work on `file:` protocol."), d
    }(), c.support.flash && (0 || !c.html5 || !c.support.html5 || c.cors && !c.support.cors || c.media && !c.support.media) && function() {
        function h(a) {
            return ('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="' + (a.width || "100%") + '" height="' + (a.height || "100%") + '"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="' + (a.width || "100%") + '" height="' + (a.height || "100%") + '" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi, function(b, c) {
                return a[c]
            })
        }

        function i(a, b) {
            if (a && a.style) {
                var c, d;
                for (c in b) {
                    d = b[c], "number" == typeof d && (d += "px");
                    try {
                        a.style[c] = d
                    } catch (e) {}
                }
            }
        }

        function j(a, b) {
            g(b, function(b, c) {
                var d = a[c];
                a[c] = function() {
                    return this.parent = d, b.apply(this, arguments)
                }
            })
        }

        function k(a) {
            return a && !a.flashId
        }

        function l(a) {
            var b = a.wid = c.uid();
            return v._fn[b] = a, "FileAPI.Flash._fn." + b
        }

        function m(a) {
            try {
                v._fn[a.wid] = null, delete v._fn[a.wid]
            } catch (b) {}
        }

        function n(a, b) {
            if (!u.test(a)) {
                if (/^\.\//.test(a) || "/" != a.charAt(0)) {
                    var c = e.pathname;
                    c = c.substr(0, c.lastIndexOf("/")), a = (c + "/" + a).replace("/./", "/")
                }
                "//" != a.substr(0, 2) && (a = "//" + e.host + a), u.test(a) || (a = e.protocol + a)
            }
            return b && (a += (/\?/.test(a) ? "&" : "?") + b), a
        }

        function o(a, b, e) {
            function f() {
                try {
                    var a = v.get(j);
                    a.setImage(b)
                } catch (d) {
                    c.log('[err] FlashAPI.Preview.setImage -- can not set "base64":', d)
                }
            }
            var g, j = c.uid(),
                k = d.createElement("div"),
                o = 10;
            for (g in a) k.setAttribute(g, a[g]), k[g] = a[g];
            i(k, a), a.width = "100%", a.height = "100%", k.innerHTML = h(c.extend({
                id: j,
                src: n(c.flashImageUrl, "r=" + c.uid()),
                wmode: "opaque",
                flashvars: "scale=" + a.scale + "&callback=" + l(function p() {
                    return m(p), --o > 0 && f(), !0
                })
            }, a)), e(!1, k), k = null
        }

        function p(a) {
            return {
                id: a.id,
                name: a.name,
                matrix: a.matrix,
                flashId: a.flashId
            }
        }

        function q(b) {
            var c = b.getBoundingClientRect(),
                e = d.body,
                f = (b && b.ownerDocument).documentElement;
            return {
                top: c.top + (a.pageYOffset || f.scrollTop) - (f.clientTop || e.clientTop || 0),
                left: c.left + (a.pageXOffset || f.scrollLeft) - (f.clientLeft || e.clientLeft || 0),
                width: c.right - c.left,
                height: c.bottom - c.top
            }
        }
        var r = c.uid(),
            s = 0,
            t = {},
            u = /^https?:/i,
            v = {
                _fn: {},
                init: function() {
                    var a = d.body && d.body.firstChild;
                    if (a)
                        do
                            if (1 == a.nodeType) {
                                c.log("FlashAPI.state: awaiting");
                                var b = d.createElement("div");
                                return b.id = "_" + r, i(b, {
                                    top: 1,
                                    right: 1,
                                    width: 5,
                                    height: 5,
                                    position: "absolute",
                                    zIndex: 1e6 + ""
                                }), a.parentNode.insertBefore(b, a), void v.publish(b, r)
                            }
                    while (a = a.nextSibling);
                    10 > s && setTimeout(v.init, 50 * ++s)
                },
                publish: function(a, b, d) {
                    d = d || {}, a.innerHTML = h({
                        id: b,
                        src: n(c.flashUrl, "r=" + c.version),
                        wmode: d.camera ? "" : "transparent",
                        flashvars: "callback=" + (d.onEvent || "FileAPI.Flash.onEvent") + "&flashId=" + b + "&storeKey=" + f.userAgent.match(/\d/gi).join("") + "_" + c.version + (v.isReady || (c.pingUrl ? "&ping=" + c.pingUrl : "")) + "&timeout=" + c.flashAbortTimeout + (d.camera ? "&useCamera=" + n(c.flashWebcamUrl) : "") + "&debug=" + (c.debug ? "1" : "")
                    }, d)
                },
                ready: function() {
                    c.log("FlashAPI.state: ready"), v.ready = c.F, v.isReady = !0, v.patch(), v.patchCamera && v.patchCamera(), c.event.on(d, "mouseover", v.mouseover), c.event.on(d, "click", function(a) {
                        v.mouseover(a) && (a.preventDefault ? a.preventDefault() : a.returnValue = !0)
                    })
                },
                getEl: function() {
                    return d.getElementById("_" + r)
                },
                getWrapper: function(a) {
                    do
                        if (/js-fileapi-wrapper/.test(a.className)) return a;
                    while ((a = a.parentNode) && a !== d.body)
                },
                mouseover: function(a) {
                    var b = c.event.fix(a).target;
                    if (/input/i.test(b.nodeName) && "file" == b.type) {
                        var e = b.getAttribute(r),
                            f = v.getWrapper(b);
                        if (c.multiFlash) {
                            if ("i" == e || "r" == e) return !1;
                            if ("p" != e) {
                                b.setAttribute(r, "i");
                                var g = d.createElement("div");
                                if (!f) return void c.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");
                                i(g, {
                                    top: 0,
                                    left: 0,
                                    width: b.offsetWidth + 100,
                                    height: b.offsetHeight + 100,
                                    zIndex: 1e6 + "",
                                    position: "absolute"
                                }), f.appendChild(g), v.publish(g, c.uid()), b.setAttribute(r, "p")
                            }
                            return !0
                        }
                        if (f) {
                            var h = q(f);
                            i(v.getEl(), h), v.curInp = b
                        }
                    } else /object|embed/i.test(b.nodeName) || i(v.getEl(), {
                        top: 1,
                        left: 1,
                        width: 5,
                        height: 5
                    })
                },
                onEvent: function(a) {
                    var b = a.type;
                    if ("ready" == b) {
                        try {
                            v.getInput(a.flashId).setAttribute(r, "r")
                        } catch (d) {}
                        return v.ready(), setTimeout(function() {
                            v.mouseenter(a)
                        }, 50), !0
                    }
                    "ping" === b ? c.log("(flash -> js).ping:", [a.status, a.savedStatus], a.error) : "log" === b ? c.log("(flash -> js).log:", a.target) : b in v && setTimeout(function() {
                        c.log("FlashAPI.event." + a.type + ":", a), v[b](a)
                    }, 1)
                },
                mouseenter: function(a) {
                    var b = v.getInput(a.flashId);
                    if (b) {
                        v.cmd(a, "multiple", null != b.getAttribute("multiple"));
                        var d = [],
                            e = {};
                        g((b.getAttribute("accept") || "").split(/,\s*/), function(a) {
                            c.accept[a] && g(c.accept[a].split(" "), function(a) {
                                e[a] = 1
                            })
                        }), g(e, function(a, b) {
                            d.push(b)
                        }), v.cmd(a, "accept", d.length ? d.join(",") + "," + d.join(",").toUpperCase() : "*")
                    }
                },
                get: function(b) {
                    return d[b] || a[b] || d.embeds[b]
                },
                getInput: function(a) {
                    if (!c.multiFlash) return v.curInp;
                    try {
                        var b = v.getWrapper(v.get(a));
                        if (b) return b.getElementsByTagName("input")[0]
                    } catch (d) {
                        c.log('[err] Can not find "input" by flashId:', a, d)
                    }
                },
                select: function(a) {
                    var e, f = v.getInput(a.flashId),
                        h = c.uid(f),
                        i = a.target.files;
                    g(i, function(a) {
                        c.checkFileObj(a)
                    }), t[h] = i, d.createEvent ? (e = d.createEvent("Event"), e.files = i, e.initEvent("change", !0, !0), f.dispatchEvent(e)) : b ? b(f).trigger({
                        type: "change",
                        files: i
                    }) : (e = d.createEventObject(), e.files = i, f.fireEvent("onchange", e))
                },
                cmd: function(a, b, d, e) {
                    try {
                        return c.log("(js -> flash)." + b + ":", d), v.get(a.flashId || a).cmd(b, d)
                    } catch (f) {
                        c.log("(js -> flash).onError:", f), e || setTimeout(function() {
                            v.cmd(a, b, d, !0)
                        }, 50)
                    }
                },
                patch: function() {
                    c.flashEngine = !0, j(c, {
                        getFiles: function(a, b, d) {
                            if (d) return c.filterFiles(c.getFiles(a), b, d), null;
                            var e = c.isArray(a) ? a : t[c.uid(a.target || a.srcElement || a)];
                            return e ? (b && (b = c.getFilesFilter(b), e = c.filter(e, function(a) {
                                return b.test(a.name)
                            })), e) : this.parent.apply(this, arguments)
                        },
                        getInfo: function(a, b) {
                            if (k(a)) this.parent.apply(this, arguments);
                            else if (a.isShot) b(null, a.info = {
                                width: a.width,
                                height: a.height
                            });
                            else {
                                if (!a.__info) {
                                    var d = a.__info = c.defer();
                                    v.cmd(a, "getFileInfo", {
                                        id: a.id,
                                        callback: l(function e(b, c) {
                                            m(e), d.resolve(b, a.info = c)
                                        })
                                    })
                                }
                                a.__info.then(b)
                            }
                        }
                    }), c.support.transform = !0, c.Image && j(c.Image.prototype, {
                        get: function(a, b) {
                            return this.set({
                                scaleMode: b || "noScale"
                            }), this.parent(a)
                        },
                        _load: function(a, b) {
                            if (c.log("FlashAPI.Image._load:", a), k(a)) this.parent.apply(this, arguments);
                            else {
                                var d = this;
                                c.getInfo(a, function(c) {
                                    b.call(d, c, a)
                                })
                            }
                        },
                        _apply: function(a, b) {
                            if (c.log("FlashAPI.Image._apply:", a), k(a)) this.parent.apply(this, arguments);
                            else {
                                var d = this.getMatrix(a.info),
                                    e = b;
                                v.cmd(a, "imageTransform", {
                                    id: a.id,
                                    matrix: d,
                                    callback: l(function f(g, h) {
                                        c.log("FlashAPI.Image._apply.callback:", g), m(f), g ? e(g) : c.support.html5 || c.support.dataURI && !(h.length > 3e4) ? (d.filter && (e = function(a, e) {
                                            a ? b(a) : c.Image.applyFilter(e, d.filter, function() {
                                                b(a, this.canvas)
                                            })
                                        }), c.newImage("data:" + a.type + ";base64," + h, e)) : o({
                                            width: d.deg % 180 ? d.dh : d.dw,
                                            height: d.deg % 180 ? d.dw : d.dh,
                                            scale: d.scaleMode
                                        }, h, e)
                                    })
                                })
                            }
                        },
                        toData: function(a) {
                            var b = this.file,
                                d = b.info,
                                e = this.getMatrix(d);
                            c.log("FlashAPI.Image.toData"), k(b) ? this.parent.apply(this, arguments) : ("auto" == e.deg && (e.deg = c.Image.exifOrientation[d && d.exif && d.exif.Orientation] || 0), a.call(this, !b.info, {
                                id: b.id,
                                flashId: b.flashId,
                                name: b.name,
                                type: b.type,
                                matrix: e
                            }))
                        }
                    }), c.Image && j(c.Image, {
                        fromDataURL: function(a, b, d) {
                            !c.support.dataURI || a.length > 3e4 ? o(c.extend({
                                scale: "exactFit"
                            }, b), a.replace(/^data:[^,]+,/, ""), function(a, b) {
                                d(b)
                            }) : this.parent(a, b, d)
                        }
                    }), j(c.Form.prototype, {
                        toData: function(a) {
                            for (var b = this.items, d = b.length; d--;)
                                if (b[d].file && k(b[d].blob)) return this.parent.apply(this, arguments);
                            c.log("FlashAPI.Form.toData"), a(b)
                        }
                    }), j(c.XHR.prototype, {
                        _send: function(a, b) {
                            if (b.nodeName || b.append && c.support.html5 || c.isArray(b) && "string" == typeof b[0]) return this.parent.apply(this, arguments);
                            var d, e, f = {},
                                h = {},
                                i = this;
                            if (g(b, function(a) {
                                    a.file ? (h[a.name] = a = p(a.blob), e = a.id, d = a.flashId) : f[a.name] = a.blob
                                }), e || (d = r), !d) return c.log("[err] FlashAPI._send: flashId -- undefined"), this.parent.apply(this, arguments);
                            c.log("FlashAPI.XHR._send: " + d + " -> " + e), i.xhr = {
                                headers: {},
                                abort: function() {
                                    v.cmd(d, "abort", {
                                        id: e
                                    })
                                },
                                getResponseHeader: function(a) {
                                    return this.headers[a]
                                },
                                getAllResponseHeaders: function() {
                                    return this.headers
                                }
                            };
                            var j = c.queue(function() {
                                v.cmd(d, "upload", {
                                    url: n(a.url.replace(/([a-z]+)=(\?)&?/i, "")),
                                    data: f,
                                    files: e ? h : null,
                                    headers: a.headers || {},
                                    callback: l(function b(d) {
                                        var e = d.type,
                                            f = d.result;
                                        c.log("FlashAPI.upload." + e), "progress" == e ? (d.loaded = Math.min(d.loaded, d.total), d.lengthComputable = !0, a.progress(d)) : "complete" == e ? (m(b), "string" == typeof f && (i.responseText = f.replace(/%22/g, '"').replace(/%5c/g, "\\").replace(/%26/g, "&").replace(/%25/g, "%")), i.end(d.status || 200)) : ("abort" == e || "error" == e) && (i.end(d.status || 0, d.message), m(b))
                                    })
                                })
                            });
                            g(h, function(a) {
                                j.inc(), c.getInfo(a, j.next)
                            }), j.check()
                        }
                    })
                }
            };
        c.Flash = v, c.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==", function(a, b) {
            c.support.dataURI = !(1 != b.width || 1 != b.height), v.init()
        })
    }()
}(window, window.jQuery, FileAPI),
function(a, b, c) {
    "use strict";
    var d = c.each,
        e = [];
    c.support.flash && c.media && !c.support.media && ! function() {
        function a(a) {
            var b = a.wid = c.uid();
            return c.Flash._fn[b] = a, "FileAPI.Flash._fn." + b
        }

        function b(a) {
            try {
                c.Flash._fn[a.wid] = null, delete c.Flash._fn[a.wid]
            } catch (b) {}
        }
        var f = c.Flash;
        c.extend(c.Flash, {
            patchCamera: function() {
                c.Camera.fallback = function(d, e, g) {
                    var h = c.uid();
                    c.log("FlashAPI.Camera.publish: " + h), f.publish(d, h, c.extend(e, {
                        camera: !0,
                        onEvent: a(function i(a) {
                            "camera" === a.type && (b(i), a.error ? (c.log("FlashAPI.Camera.publish.error: " + a.error), g(a.error)) : (c.log("FlashAPI.Camera.publish.success: " + h), g(null)))
                        })
                    }))
                }, d(e, function(a) {
                    c.Camera.fallback.apply(c.Camera, a)
                }), e = [], c.extend(c.Camera.prototype, {
                    _id: function() {
                        return this.video.id
                    },
                    start: function(d) {
                        var e = this;
                        f.cmd(this._id(), "camera.on", {
                            callback: a(function g(a) {
                                b(g), a.error ? (c.log("FlashAPI.camera.on.error: " + a.error), d(a.error, e)) : (c.log("FlashAPI.camera.on.success: " + e._id()), e._active = !0, d(null, e))
                            })
                        })
                    },
                    stop: function() {
                        this._active = !1, f.cmd(this._id(), "camera.off")
                    },
                    shot: function() {
                        c.log("FlashAPI.Camera.shot:", this._id());
                        var a = c.Flash.cmd(this._id(), "shot", {});
                        return a.type = "image/png", a.flashId = this._id(), a.isShot = !0, new c.Camera.Shot(a)
                    }
                })
            }
        }), c.Camera.fallback = function() {
            e.push(arguments)
        }
    }()
}(window, window.jQuery, FileAPI), "function" == typeof define && define.amd && define("FileAPI", [], function() {
        return FileAPI
    }),
    function() {
        var a = function(a, b, c) {
                var d = a,
                    e = b || 0,
                    f = 0;
                this.getRawData = function() {
                    return d
                }, "string" == typeof a && (f = c || d.length, this.getByteAt = function(a) {
                    return 255 & d.charCodeAt(a + e)
                }, this.getBytesAt = function(a, b) {
                    for (var c = [], f = 0; b > f; f++) c[f] = 255 & d.charCodeAt(a + f + e);
                    return c
                }), this.getLength = function() {
                    return f
                }, this.getSByteAt = function(a) {
                    return a = this.getByteAt(a), a > 127 ? a - 256 : a
                }, this.getShortAt = function(a, b) {
                    var c = b ? (this.getByteAt(a) << 8) + this.getByteAt(a + 1) : (this.getByteAt(a + 1) << 8) + this.getByteAt(a);
                    return 0 > c && (c += 65536), c
                }, this.getSShortAt = function(a, b) {
                    var c = this.getShortAt(a, b);
                    return c > 32767 ? c - 65536 : c
                }, this.getLongAt = function(a, b) {
                    var c = this.getByteAt(a),
                        d = this.getByteAt(a + 1),
                        e = this.getByteAt(a + 2),
                        f = this.getByteAt(a + 3),
                        c = b ? (((c << 8) + d << 8) + e << 8) + f : (((f << 8) + e << 8) + d << 8) + c;
                    return 0 > c && (c += 4294967296), c
                }, this.getSLongAt = function(a, b) {
                    var c = this.getLongAt(a, b);
                    return c > 2147483647 ? c - 4294967296 : c
                }, this.getStringAt = function(a, b) {
                    for (var c = [], d = this.getBytesAt(a, b), e = 0; b > e; e++) c[e] = String.fromCharCode(d[e]);
                    return c.join("")
                }, this.getCharAt = function(a) {
                    return String.fromCharCode(this.getByteAt(a))
                }, this.toBase64 = function() {
                    return window.btoa(d)
                }, this.fromBase64 = function(a) {
                    d = window.atob(a)
                }
            },
            b = {};
        ! function() {
            function a(a) {
                if (255 != a.getByteAt(0) || 216 != a.getByteAt(1)) return !1;
                for (var b = 2, c = a.getLength(); c > b;) {
                    if (255 != a.getByteAt(b)) return f && console.log("Not a valid marker at offset " + b + ", found: " + a.getByteAt(b)), !1;
                    var d = a.getByteAt(b + 1);
                    if (22400 == d || 225 == d) return f && console.log("Found 0xFFE1 marker"), e(a, b + 4, a.getShortAt(b + 2, !0) - 2);
                    b += 2 + a.getShortAt(b + 2, !0)
                }
            }

            function c(a, b, c, e, g) {
                for (var h = a.getShortAt(c, g), i = {}, j = 0; h > j; j++) {
                    var k = c + 12 * j + 2,
                        l = e[a.getShortAt(k, g)];
                    !l && f && console.log("Unknown tag: " + a.getShortAt(k, g)), i[l] = d(a, k, b, c, g)
                }
                return i
            }

            function d(a, b, c, d, e) {
                var f = a.getShortAt(b + 2, e),
                    d = a.getLongAt(b + 4, e),
                    c = a.getLongAt(b + 8, e) + c;
                switch (f) {
                    case 1:
                    case 7:
                        if (1 == d) return a.getByteAt(b + 8, e);
                        for (c = d > 4 ? c : b + 8, b = [], f = 0; d > f; f++) b[f] = a.getByteAt(c + f);
                        return b;
                    case 2:
                        return a.getStringAt(d > 4 ? c : b + 8, d - 1);
                    case 3:
                        if (1 == d) return a.getShortAt(b + 8, e);
                        for (c = d > 2 ? c : b + 8, b = [], f = 0; d > f; f++) b[f] = a.getShortAt(c + 2 * f, e);
                        return b;
                    case 4:
                        if (1 == d) return a.getLongAt(b + 8, e);
                        for (b = [], f = 0; d > f; f++) b[f] = a.getLongAt(c + 4 * f, e);
                        return b;
                    case 5:
                        if (1 == d) return a.getLongAt(c, e) / a.getLongAt(c + 4, e);
                        for (b = [], f = 0; d > f; f++) b[f] = a.getLongAt(c + 8 * f, e) / a.getLongAt(c + 4 + 8 * f, e);
                        return b;
                    case 9:
                        if (1 == d) return a.getSLongAt(b + 8, e);
                        for (b = [], f = 0; d > f; f++) b[f] = a.getSLongAt(c + 4 * f, e);
                        return b;
                    case 10:
                        if (1 == d) return a.getSLongAt(c, e) / a.getSLongAt(c + 4, e);
                        for (b = [], f = 0; d > f; f++) b[f] = a.getSLongAt(c + 8 * f, e) / a.getSLongAt(c + 4 + 8 * f, e);
                        return b
                }
            }

            function e(a, d) {
                if ("Exif" != a.getStringAt(d, 4)) return f && console.log("Not valid EXIF data! " + a.getStringAt(d, 4)), !1;
                var e, g = d + 6;
                if (18761 == a.getShortAt(g)) e = !1;
                else {
                    if (19789 != a.getShortAt(g)) return f && console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"), !1;
                    e = !0
                }
                if (42 != a.getShortAt(g + 2, e)) return f && console.log("Not valid TIFF data! (no 0x002A)"), !1;
                if (8 != a.getLongAt(g + 4, e)) return f && console.log("Not valid TIFF data! (First offset not 8)", a.getShortAt(g + 4, e)), !1;
                var h = c(a, g, g + 8, b.TiffTags, e);
                if (h.ExifIFDPointer) {
                    var i, j = c(a, g, g + h.ExifIFDPointer, b.Tags, e);
                    for (i in j) {
                        switch (i) {
                            case "LightSource":
                            case "Flash":
                            case "MeteringMode":
                            case "ExposureProgram":
                            case "SensingMethod":
                            case "SceneCaptureType":
                            case "SceneType":
                            case "CustomRendered":
                            case "WhiteBalance":
                            case "GainControl":
                            case "Contrast":
                            case "Saturation":
                            case "Sharpness":
                            case "SubjectDistanceRange":
                            case "FileSource":
                                j[i] = b.StringValues[i][j[i]];
                                break;
                            case "ExifVersion":
                            case "FlashpixVersion":
                                j[i] = String.fromCharCode(j[i][0], j[i][1], j[i][2], j[i][3]);
                                break;
                            case "ComponentsConfiguration":
                                j[i] = b.StringValues.Components[j[i][0]] + b.StringValues.Components[j[i][1]] + b.StringValues.Components[j[i][2]] + b.StringValues.Components[j[i][3]]
                        }
                        h[i] = j[i]
                    }
                }
                if (h.GPSInfoIFDPointer)
                    for (i in e = c(a, g, g + h.GPSInfoIFDPointer, b.GPSTags, e)) {
                        switch (i) {
                            case "GPSVersionID":
                                e[i] = e[i][0] + "." + e[i][1] + "." + e[i][2] + "." + e[i][3]
                        }
                        h[i] = e[i]
                    }
                return h
            }
            var f = !1;
            b.Tags = {
                36864: "ExifVersion",
                40960: "FlashpixVersion",
                40961: "ColorSpace",
                40962: "PixelXDimension",
                40963: "PixelYDimension",
                37121: "ComponentsConfiguration",
                37122: "CompressedBitsPerPixel",
                37500: "MakerNote",
                37510: "UserComment",
                40964: "RelatedSoundFile",
                36867: "DateTimeOriginal",
                36868: "DateTimeDigitized",
                37520: "SubsecTime",
                37521: "SubsecTimeOriginal",
                37522: "SubsecTimeDigitized",
                33434: "ExposureTime",
                33437: "FNumber",
                34850: "ExposureProgram",
                34852: "SpectralSensitivity",
                34855: "ISOSpeedRatings",
                34856: "OECF",
                37377: "ShutterSpeedValue",
                37378: "ApertureValue",
                37379: "BrightnessValue",
                37380: "ExposureBias",
                37381: "MaxApertureValue",
                37382: "SubjectDistance",
                37383: "MeteringMode",
                37384: "LightSource",
                37385: "Flash",
                37396: "SubjectArea",
                37386: "FocalLength",
                41483: "FlashEnergy",
                41484: "SpatialFrequencyResponse",
                41486: "FocalPlaneXResolution",
                41487: "FocalPlaneYResolution",
                41488: "FocalPlaneResolutionUnit",
                41492: "SubjectLocation",
                41493: "ExposureIndex",
                41495: "SensingMethod",
                41728: "FileSource",
                41729: "SceneType",
                41730: "CFAPattern",
                41985: "CustomRendered",
                41986: "ExposureMode",
                41987: "WhiteBalance",
                41988: "DigitalZoomRation",
                41989: "FocalLengthIn35mmFilm",
                41990: "SceneCaptureType",
                41991: "GainControl",
                41992: "Contrast",
                41993: "Saturation",
                41994: "Sharpness",
                41995: "DeviceSettingDescription",
                41996: "SubjectDistanceRange",
                40965: "InteroperabilityIFDPointer",
                42016: "ImageUniqueID"
            }, b.TiffTags = {
                256: "ImageWidth",
                257: "ImageHeight",
                34665: "ExifIFDPointer",
                34853: "GPSInfoIFDPointer",
                40965: "InteroperabilityIFDPointer",
                258: "BitsPerSample",
                259: "Compression",
                262: "PhotometricInterpretation",
                274: "Orientation",
                277: "SamplesPerPixel",
                284: "PlanarConfiguration",
                530: "YCbCrSubSampling",
                531: "YCbCrPositioning",
                282: "XResolution",
                283: "YResolution",
                296: "ResolutionUnit",
                273: "StripOffsets",
                278: "RowsPerStrip",
                279: "StripByteCounts",
                513: "JPEGInterchangeFormat",
                514: "JPEGInterchangeFormatLength",
                301: "TransferFunction",
                318: "WhitePoint",
                319: "PrimaryChromaticities",
                529: "YCbCrCoefficients",
                532: "ReferenceBlackWhite",
                306: "DateTime",
                270: "ImageDescription",
                271: "Make",
                272: "Model",
                305: "Software",
                315: "Artist",
                33432: "Copyright"
            }, b.GPSTags = {
                0: "GPSVersionID",
                1: "GPSLatitudeRef",
                2: "GPSLatitude",
                3: "GPSLongitudeRef",
                4: "GPSLongitude",
                5: "GPSAltitudeRef",
                6: "GPSAltitude",
                7: "GPSTimeStamp",
                8: "GPSSatellites",
                9: "GPSStatus",
                10: "GPSMeasureMode",
                11: "GPSDOP",
                12: "GPSSpeedRef",
                13: "GPSSpeed",
                14: "GPSTrackRef",
                15: "GPSTrack",
                16: "GPSImgDirectionRef",
                17: "GPSImgDirection",
                18: "GPSMapDatum",
                19: "GPSDestLatitudeRef",
                20: "GPSDestLatitude",
                21: "GPSDestLongitudeRef",
                22: "GPSDestLongitude",
                23: "GPSDestBearingRef",
                24: "GPSDestBearing",
                25: "GPSDestDistanceRef",
                26: "GPSDestDistance",
                27: "GPSProcessingMethod",
                28: "GPSAreaInformation",
                29: "GPSDateStamp",
                30: "GPSDifferential"
            }, b.StringValues = {
                ExposureProgram: {
                    0: "Not defined",
                    1: "Manual",
                    2: "Normal program",
                    3: "Aperture priority",
                    4: "Shutter priority",
                    5: "Creative program",
                    6: "Action program",
                    7: "Portrait mode",
                    8: "Landscape mode"
                },
                MeteringMode: {
                    0: "Unknown",
                    1: "Average",
                    2: "CenterWeightedAverage",
                    3: "Spot",
                    4: "MultiSpot",
                    5: "Pattern",
                    6: "Partial",
                    255: "Other"
                },
                LightSource: {
                    0: "Unknown",
                    1: "Daylight",
                    2: "Fluorescent",
                    3: "Tungsten (incandescent light)",
                    4: "Flash",
                    9: "Fine weather",
                    10: "Cloudy weather",
                    11: "Shade",
                    12: "Daylight fluorescent (D 5700 - 7100K)",
                    13: "Day white fluorescent (N 4600 - 5400K)",
                    14: "Cool white fluorescent (W 3900 - 4500K)",
                    15: "White fluorescent (WW 3200 - 3700K)",
                    17: "Standard light A",
                    18: "Standard light B",
                    19: "Standard light C",
                    20: "D55",
                    21: "D65",
                    22: "D75",
                    23: "D50",
                    24: "ISO studio tungsten",
                    255: "Other"
                },
                Flash: {
                    0: "Flash did not fire",
                    1: "Flash fired",
                    5: "Strobe return light not detected",
                    7: "Strobe return light detected",
                    9: "Flash fired, compulsory flash mode",
                    13: "Flash fired, compulsory flash mode, return light not detected",
                    15: "Flash fired, compulsory flash mode, return light detected",
                    16: "Flash did not fire, compulsory flash mode",
                    24: "Flash did not fire, auto mode",
                    25: "Flash fired, auto mode",
                    29: "Flash fired, auto mode, return light not detected",
                    31: "Flash fired, auto mode, return light detected",
                    32: "No flash function",
                    65: "Flash fired, red-eye reduction mode",
                    69: "Flash fired, red-eye reduction mode, return light not detected",
                    71: "Flash fired, red-eye reduction mode, return light detected",
                    73: "Flash fired, compulsory flash mode, red-eye reduction mode",
                    77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
                    79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
                    89: "Flash fired, auto mode, red-eye reduction mode",
                    93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
                    95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
                },
                SensingMethod: {
                    1: "Not defined",
                    2: "One-chip color area sensor",
                    3: "Two-chip color area sensor",
                    4: "Three-chip color area sensor",
                    5: "Color sequential area sensor",
                    7: "Trilinear sensor",
                    8: "Color sequential linear sensor"
                },
                SceneCaptureType: {
                    0: "Standard",
                    1: "Landscape",
                    2: "Portrait",
                    3: "Night scene"
                },
                SceneType: {
                    1: "Directly photographed"
                },
                CustomRendered: {
                    0: "Normal process",
                    1: "Custom process"
                },
                WhiteBalance: {
                    0: "Auto white balance",
                    1: "Manual white balance"
                },
                GainControl: {
                    0: "None",
                    1: "Low gain up",
                    2: "High gain up",
                    3: "Low gain down",
                    4: "High gain down"
                },
                Contrast: {
                    0: "Normal",
                    1: "Soft",
                    2: "Hard"
                },
                Saturation: {
                    0: "Normal",
                    1: "Low saturation",
                    2: "High saturation"
                },
                Sharpness: {
                    0: "Normal",
                    1: "Soft",
                    2: "Hard"
                },
                SubjectDistanceRange: {
                    0: "Unknown",
                    1: "Macro",
                    2: "Close view",
                    3: "Distant view"
                },
                FileSource: {
                    3: "DSC"
                },
                Components: {
                    0: "",
                    1: "Y",
                    2: "Cb",
                    3: "Cr",
                    4: "R",
                    5: "G",
                    6: "B"
                }
            }, b.getData = function(b, c) {
                return b.complete ? (b.exifdata ? c && c() : BinaryAjax(b.src, function(d) {
                    d = a(d.binaryResponse), b.exifdata = d || {}, c && c()
                }), !0) : !1
            }, b.getTag = function(a, b) {
                return a.exifdata ? a.exifdata[b] : void 0
            }, b.getAllTags = function(a) {
                if (!a.exifdata) return {};
                var b, a = a.exifdata,
                    c = {};
                for (b in a) a.hasOwnProperty(b) && (c[b] = a[b]);
                return c
            }, b.pretty = function(a) {
                if (!a.exifdata) return "";
                var b, a = a.exifdata,
                    c = "";
                for (b in a) a.hasOwnProperty(b) && (c = "object" == typeof a[b] ? c + (b + " : [" + a[b].length + " values]\r\n") : c + (b + " : " + a[b] + "\r\n"));
                return c
            }, b.readFromBinaryFile = function(b) {
                return a(b)
            }
        }(), FileAPI.support.exif = !0, FileAPI.addInfoReader(/^image/, function(c, d) {
            if (!c.__exif) {
                var e = c.__exif = FileAPI.defer(),
                    f = c;
                if (f instanceof Blob && f.size > 131072) try {
                    var g = Math.min(f.size, 131072);
                    f = (f.slice || f.mozSlice || f.webkitSlice).call(f, 0, g)
                } catch (h) {
                    FileAPI.log("exception " + h)
                }
                FileAPI.readAsBinaryString(f, function(c) {
                    if ("load" == c.type) {
                        var d = c.result,
                            g = new a(d, 0, f.size),
                            h = b.readFromBinaryFile(g);
                        e.resolve(!1, {
                            exif: h || {}
                        })
                    } else "error" == c.type && e.resolve("read_as_binary_string_exif")
                })
            }
            c.__exif.then(d)
        })
    }(), ! function(a, b) {
        "use strict";

        function c(a) {
            var b;
            for (b in a)
                if (a.hasOwnProperty(b) && !(a[b] instanceof Object || "overlay" === b)) return !0;
            return !1
        }

        function d(a, b, c, d) {
            if (c) {
                var e = c - d,
                    f = /max/.test(b);
                (f && 0 > e || !f && e > 0) && (a.errors || (a.errors = {}), a.errors[b] = Math.abs(e))
            }
        }

        function e(a, b, c, e) {
            if (a) {
                var f = c.length - (a - b);
                f > 0 && l(c.splice(0, f), function(a, b) {
                    d(a, "maxFiles", -1, b), e.push(a)
                })
            }
        }
        var f = a.noop,
            g = !a.fn.prop,
            h = g ? "attr" : "prop",
            i = "data-fileapi",
            j = "data-fileapi-id",
            k = [].slice,
            l = b.each,
            m = b.extend,
            n = function(a, b) {
                var c = k.call(arguments, 2);
                return b.bind ? b.bind.apply(b, [a].concat(c)) : function() {
                    return b.apply(a, c.concat(k.call(arguments)))
                }
            },
            o = function(a) {
                return "[" + i + '="' + a + '"]'
            },
            p = function(a) {
                return 0 === a.indexOf("#")
            },
            q = function(b, c) {
                if (this.$el = b = a(b).on("change.fileapi", 'input[type="file"]', n(this, this._onSelect)), this.el = b[0], this._options = {}, this.options = {
                        url: 0,
                        data: {},
                        accept: 0,
                        multiple: !1,
                        paramName: 0,
                        dataType: "json",
                        duplicate: !1,
                        uploadRetry: 0,
                        networkDownRetryTimeout: 5e3,
                        chunkSize: 0,
                        chunkUploadRetry: 3,
                        chunkNetworkDownRetryTimeout: 2e3,
                        maxSize: 0,
                        maxFiles: 0,
                        imageSize: 0,
                        sortFn: 0,
                        filterFn: 0,
                        autoUpload: !1,
                        clearOnSelect: void 0,
                        clearOnComplete: void 0,
                        lang: {
                            B: "bytes",
                            KB: "KB",
                            MB: "MB",
                            GB: "GB",
                            TB: "TB"
                        },
                        sizeFormat: "0.00",
                        imageOriginal: !0,
                        imageTransform: 0,
                        imageAutoOrientation: !!FileAPI.support.exif,
                        elements: {
                            ctrl: {
                                upload: o("ctrl.upload"),
                                reset: o("ctrl.reset"),
                                abort: o("ctrl.abort")
                            },
                            empty: {
                                show: o("empty.show"),
                                hide: o("empty.hide")
                            },
                            emptyQueue: {
                                show: o("emptyQueue.show"),
                                hide: o("emptyQueue.hide")
                            },
                            active: {
                                show: o("active.show"),
                                hide: o("active.hide")
                            },
                            size: o("size"),
                            name: o("name"),
                            progress: o("progress"),
                            list: o("list"),
                            file: {
                                tpl: o("file.tpl"),
                                progress: o("file.progress"),
                                active: {
                                    show: o("file.active.show"),
                                    hide: o("file.active.hide")
                                },
                                preview: {
                                    el: 0,
                                    get: 0,
                                    width: 0,
                                    height: 0,
                                    processing: 0
                                },
                                abort: o("file.abort"),
                                remove: o("file.remove"),
                                rotate: o("file.rotate")
                            },
                            dnd: {
                                el: o("dnd"),
                                hover: "dnd_hover",
                                fallback: o("dnd.fallback")
                            }
                        },
                        onDrop: f,
                        onDropHover: f,
                        onSelect: f,
                        onBeforeUpload: f,
                        onUpload: f,
                        onProgress: f,
                        onComplete: f,
                        onFilePrepare: f,
                        onFileUpload: f,
                        onFileProgress: f,
                        onFileComplete: f,
                        onFileRemove: null,
                        onFileRemoveCompleted: null
                    }, a.extend(!0, this.options, c), c = this.options, this.option("elements.file.preview.rotate", c.imageAutoOrientation), !c.url) {
                    var d = this.$el.attr("action") || this.$el.find("form").attr("action");
                    d ? c.url = d : this._throw("url — is not defined")
                }
                this.$files = this.$elem("list"), this.$fileTpl = this.$elem("file.tpl"), this.itemTplFn = a.fn.fileapi.tpl(a("<div/>").append(this.$elem("file.tpl")).html()), l(c, function(a, b) {
                    this._setOption(b, a)
                }, this), this.$el.on("reset.fileapi", n(this, this._onReset)).on("submit.fileapi", n(this, this._onSubmit)).on("upload.fileapi progress.fileapi complete.fileapi", n(this, this._onUploadEvent)).on("fileupload.fileapi fileprogress.fileapi filecomplete.fileapi", n(this, this._onFileUploadEvent)).on("click", "[" + i + "]", n(this, this._onActionClick));
                var e = c.elements.ctrl;
                e && (this._listen("click", e.reset, n(this, this._onReset)), this._listen("click", e.upload, n(this, this._onSubmit)), this._listen("click", e.abort, n(this, this._onAbort)));
                var g = FileAPI.support.dnd;
                this.$elem("dnd.el", !0).toggle(g), this.$elem("dnd.fallback").toggle(!g), g && this.$elem("dnd.el", !0).dnd(n(this, this._onDropHover), n(this, this._onDrop)), this.$progress = this.$elem("progress"), void 0 === c.clearOnSelect && (c.clearOnSelect = !c.multiple), this.clear(), a.isArray(c.files) && (this.files = a.map(c.files, function(b) {
                    return "string" === a.type(b) && (b = {
                        src: b,
                        name: b.split("/").pop(),
                        type: /jpe?g|png|bmp|gif|tiff?/i.test(b) && "image/" + b.split(".").pop(),
                        size: 0
                    }), b.complete = !0, b
                }), this._redraw())
            };
        q.prototype = {
            constructor: q,
            _throw: function(a) {
                throw "jquery.fileapi: " + a
            },
            _getFiles: function(a, c) {
                var f = this.options,
                    g = f.maxSize,
                    h = f.maxFiles,
                    i = f.filterFn,
                    j = this.files.length,
                    k = b.getFiles(a),
                    m = {
                        all: k,
                        files: [],
                        other: [],
                        duplicate: f.duplicate ? [] : this._extractDuplicateFiles(k)
                    },
                    n = f.imageSize,
                    o = this;
                n || i ? b.filterFiles(k, function(a, b) {
                    return b && n && (d(a, "minWidth", n.minWidth, b.width), d(a, "minHeight", n.minHeight, b.height), d(a, "maxWidth", n.maxWidth, b.width), d(a, "maxHeight", n.maxHeight, b.height)), d(a, "maxSize", g, a.size), !a.errors && (!i || i(a, b))
                }, function(a, b) {
                    e(h, j, a, b), m.other = b, m.files = a, c.call(o, m)
                }) : (l(k, function(a) {
                    d(a, "maxSize", g, a.size), m[a.errors ? "other" : "files"].push(a)
                }), e(h, j, m.files, m.other), c.call(o, m))
            },
            _extractDuplicateFiles: function(a) {
                for (var b, c = [], d = a.length, e = this.files; d--;)
                    for (b = e.length; b--;)
                        if (this._fileCompare(a[d], e[b])) {
                            c.push(a.splice(d, 1));
                            break
                        }
                return c
            },
            _fileCompare: function(a, b) {
                return a.size == b.size && a.name == b.name
            },
            _getFormatedSize: function(a) {
                var c = this.options,
                    d = "B";
                return a >= b.TB ? a /= b[d = "TB"] : a >= b.GB ? a /= b[d = "GB"] : a >= b.MB ? a /= b[d = "MB"] : a >= b.KB && (a /= b[d = "KB"]), c.sizeFormat.replace(/^\d+([^\d]+)(\d*)/, function(b, e, f) {
                    return a = (parseFloat(a) || 0).toFixed(f.length), (a + "").replace(".", e) + " " + c.lang[d]
                })
            },
            _onSelect: function(a) {
                this.options.clearOnSelect && (this.queue = [], this.files = []), this._getFiles(a, n(this, function(b) {
                    b.all.length && this.emit("select", b) !== !1 && this.add(b.files), FileAPI.reset(a.target)
                }))
            },
            _onActionClick: function(b) {
                var c = b.currentTarget,
                    d = a.attr(c, i),
                    e = a(c).closest("[" + j + "]", this.$el).attr(j),
                    f = this._getFile(e),
                    g = !0;
                this.$file(e).attr("disabled") || ("file.remove" == d ? f && this.emit("fileRemove" + (f.complete ? "Completed" : ""), f) && this.remove(e) : /^file\.rotate/.test(d) ? this.rotate(e, /ccw/.test(d) ? "-=90" : "+=90") : g = !1), g && b.preventDefault()
            },
            _listen: function(b, c, d) {
                c && l(a.trim(c).split(","), function(c) {
                    c = a.trim(c), p(c) ? a(c).on(b + ".fileapi", d) : this.$el.on(b + ".fileapi", c, d)
                }, this)
            },
            _onSubmit: function(a) {
                a.preventDefault(), this.upload()
            },
            _onReset: function(a) {
                a.preventDefault(), this.clear(!0)
            },
            _onAbort: function(a) {
                a.preventDefault(), this.abort()
            },
            _onDrop: function(a) {
                this._getFiles(a, function(a) {
                    this.emit("drop", a) !== !1 && this.add(a.files)
                })
            },
            _onDropHover: function(b, c) {
                if (this.emit("dropHover", {
                        state: b,
                        event: c
                    }) !== !1) {
                    var d = this.option("elements.dnd.hover");
                    d && a(c.currentTarget).toggleClass(d, b)
                }
            },
            _getFile: function(a) {
                return b.filter(this.files, function(c) {
                    return b.uid(c) == a
                })[0]
            },
            _getUploadEvent: function(a, b) {
                var c = {
                    xhr: a,
                    file: this.xhr.currentFile,
                    files: this.xhr.files,
                    widget: this
                };
                return m(c, b)
            },
            _emitUploadEvent: function(a, b, c) {
                var d = this._getUploadEvent(c);
                this.emit(a + "Upload", d)
            },
            _emitProgressEvent: function(a, b, c, d) {
                var e = this._getUploadEvent(d, b);
                this.emit(a + "Progress", e)
            },
            _emitCompleteEvent: function(b, c, d, e) {
                var f = this._getUploadEvent(d, {
                    error: c,
                    status: d.status,
                    statusText: d.statusText,
                    result: d.responseText
                });
                if ("file" == b && (e.complete = !0), "json" == this.options.dataType) try {
                    f.result = a.parseJSON(f.result)
                } catch (c) {
                    f.error = c
                }
                this.emit(b + "Complete", f)
            },
            _onUploadEvent: function(a, b) {
                var c = this,
                    d = c.$progress,
                    e = a.type;
                if ("progress" == e) d.stop().animate({
                    width: b.loaded / b.total * 100 + "%"
                }, 300);
                else if ("upload" == e) d.width(0);
                else {
                    var f = function() {
                        d.dequeue(), c[c.options.clearOnComplete ? "clear" : "dequeue"]()
                    };
                    this.xhr = null, this.active = !1, d.length ? d.queue(f) : f()
                }
            },
            _onFileUploadPrepare: function(d, e) {
                var f = b.uid(d),
                    g = this._rotate[f],
                    h = this._crop[f],
                    i = this._resize[f],
                    j = this._getUploadEvent(this.xhr);
                if (g || h || i) {
                    var k = a.extend(!0, {}, e.imageTransform || {});
                    g = g || (this.options.imageAutoOrientation ? "auto" : void 0), a.isEmptyObject(k) || c(k) ? (m(k, i), k.crop = h, k.rotate = g) : l(k, function(a) {
                        m(a, i), a.crop = h, a.rotate = g
                    }), e.imageTransform = k
                }
                j.file = d, j.options = e, this.emit("filePrepare", j)
            },
            _onFileUploadEvent: function(a, c) {
                var d = this,
                    e = a.type.substr(4),
                    f = b.uid(c.file),
                    g = this.$file(f),
                    h = this._$fileprogress,
                    i = this.options;
                if (this.__fileId !== f && (this.__fileId = f, this._$fileprogress = h = this.$elem("file.progress", g)), "progress" == e) h.stop().animate({
                    width: c.loaded / c.total * 100 + "%"
                }, 300);
                else if ("upload" == e || "complete" == e) {
                    var j = function() {
                        var a = "file." + e,
                            b = d.$elem("file.remove", g);
                        "upload" == e ? (b.hide(), h.width(0)) : i.onRemoveCompleted && b.show(), h.dequeue(), d.$elem(a + ".show", g).show(), d.$elem(a + ".hide", g).hide()
                    };
                    h.length ? h.queue(j) : j(), "complete" == e && (this.uploaded.push(c.file), delete this._rotate[f])
                }
            },
            _redraw: function(c) {
                var d = this.files,
                    e = !!this.active,
                    f = !d.length && !e,
                    g = !this.queue.length && !e,
                    i = [],
                    k = 0,
                    m = this.$files,
                    n = m.children().length,
                    o = this.option("elements.file.preview"),
                    p = this.option("elements.preview.el");
                c && this.$files.empty(), c && p && !this.queue.length && this.$(p).empty(), l(d, function(c, d) {
                    var e = b.uid(c);
                    if (i.push(c.name), k += c.complete ? 0 : c.size, m.length && !this.$file(e).length) {
                        var f = this.itemTplFn({
                                $idx: n + d,
                                uid: e,
                                name: c.name,
                                type: c.type,
                                size: c.size,
                                sizeText: this._getFormatedSize(c.size)
                            }),
                            g = a(f).attr(j, e);
                        c.$el = g, m.append(g), c.complete && (this.$elem("file.upload.hide", g).hide(), this.$elem("file.complete.hide", g).hide()), o.el && this._makeFilePreview(e, c, o)
                    }
                }, this), this.$elem("name").text(i.join(", ")), this.$elem("size").text(g ? "" : this._getFormatedSize(k)), this.$elem("empty.show").toggle(f), this.$elem("empty.hide").toggle(!f), this.$elem("emptyQueue.show").toggle(g), this.$elem("emptyQueue.hide").toggle(!g), this.$elem("active.show").toggle(e), this.$elem("active.hide").toggle(!e), this.$(".js-fileapi-wrapper,:file")[e ? "attr" : "removeAttr"]("aria-disabled", e)[h]("disabled", e), this._disableElem("ctrl.upload", g || e), this._disableElem("ctrl.reset", g || e), this._disableElem("ctrl.abort", !e)
            },
            _disableElem: function(a, b) {
                this.$elem(a)[b ? "attr" : "removeAttr"]("aria-disabled", "disabled")[h]("disabled", b)
            },
            _makeFilePreview: function(a, c, d, e) {
                var f = this,
                    g = e ? f.$(d.el) : f.$file(a).find(d.el);
                if (!f._crop[a])
                    if (/^image/.test(c.type)) {
                        var h = b.Image(c.src || c),
                            i = function() {
                                h.get(function(b, e) {
                                    f._crop[a] || (b ? (d.get && d.get(g, c), f.emit("previewError", [b, c])) : g.html(e))
                                })
                            };
                        d.width && h.preview(d.width, d.height), d.rotate && h.rotate("auto"), d.processing ? d.processing(c, h, i) : i()
                    } else d.get && d.get(g, c)
            },
            emit: function(b, c) {
                var d, e = this.options,
                    f = a.Event(b.toLowerCase());
                return f.widget = this, b = a.camelCase("on-" + b), a.isFunction(e[b]) && (d = e[b].call(this.el, f, c)), this.$el.triggerHandler(f, c), d !== !1 && !f.isDefaultPrevented()
            },
            add: function(c, d) {
                if (c = [].concat(c), c.length) {
                    var e = this.options,
                        f = e.sortFn,
                        g = e.elements.preview;
                    f && c.sort(f), g && !a.isPlainObject(g.el) && l(c, function(a) {
                        this._makeFilePreview(b.uid(a), a, g, !0)
                    }, this), this.xhr && this.xhr.append(c), this.queue = d ? c : this.queue.concat(c), this.files = d ? c : this.files.concat(c), this.active ? (this.xhr.append(c), this._redraw(d)) : (this._redraw(d), this.options.autoUpload && this.upload())
                }
            },
            $: function(b, c) {
                return "string" == typeof b && (b = /^#/.test(b) ? b : (c ? a(c) : this.$el).find(b)), a(b)
            },
            $elem: function(b, c, d) {
                c && c.jquery && (d = c, c = !1);
                var e = this.option("elements." + b);
                return void 0 === e && c && (e = this.option("elements." + b.substr(0, b.lastIndexOf(".")))), this.$("string" != a.type(e) && a.isEmptyObject(e) ? [] : e, d)
            },
            $file: function(a) {
                return this.$("[" + j + '="' + a + '"]')
            },
            option: function(b, c) {
                if (void 0 !== c && a.isPlainObject(c)) return l(c, function(a, c) {
                    this.option(b + "." + c, a)
                }, this), this;
                var d, e, f = this.options,
                    g = f[b],
                    h = 0;
                if (-1 != b.indexOf("."))
                    for (g = f, b = b.split("."), d = b.length; d > h; h++) {
                        if (e = b[h], void 0 !== c && d - h === 1) {
                            g[e] = c;
                            break
                        }
                        g[e] || (g[e] = {}), g = g[e]
                    } else void 0 !== c && (f[b] = c);
                return void 0 !== c && (this._setOption(b, c, this._options[b]), this._options[b] = c), void 0 !== c ? c : g
            },
            _setOption: function(a, b) {
                switch (a) {
                    case "accept":
                    case "multiple":
                    case "paramName":
                        "paramName" == a && (a = "name"), b && this.$(":file")[h](a, b)
                }
            },
            serialize: function() {
                var b, c = {};
                return this.$el.find(":input").each(function(d, e) {
                    (d = e.name) && !e.disabled && (e.checked || /select|textarea|input/i.test(e.nodeName) && !/checkbox|radio|file/i.test(e.type)) && (b = a(e).val(), void 0 !== c[d] ? (c[d].push || (c[d] = [c[d]]), c[d].push(b)) : c[d] = b)
                }), c
            },
            upload: function() {
                if (!this.active && this.emit("beforeUpload", {
                        widget: this,
                        files: this.queue
                    })) {
                    this.active = !0;
                    var a = this.$el,
                        c = this.options,
                        d = {},
                        e = {
                            url: c.url,
                            data: m({}, this.serialize(), c.data),
                            headers: c.headers,
                            files: d,
                            uploadRetry: c.uploadRetry,
                            networkDownRetryTimeout: c.networkDownRetryTimeout,
                            chunkSize: c.chunkSize,
                            chunkUploadRetry: c.chunkUploadRetry,
                            chunkNetworkDownRetryTimeout: c.chunkNetworkDownRetryTimeout,
                            prepare: n(this, this._onFileUploadPrepare),
                            imageOriginal: c.imageOriginal,
                            imageTransform: c.imageTransform
                        };
                    d[a.find(":file").attr("name") || "files[]"] = this.queue, l(["Upload", "Progress", "Complete"], function(a) {
                        var b = a.toLowerCase();
                        e[b] = n(this, this["_emit" + a + "Event"], ""), e["file" + b] = n(this, this["_emit" + a + "Event"], "file")
                    }, this), this.xhr = b.upload(e), this._redraw()
                }
            },
            abort: function(a) {
                this.active && this.xhr && this.xhr.abort(a)
            },
            crop: function(c, d) {
                var e = b.uid(c),
                    f = this.options,
                    g = f.multiple ? this.option("elements.file.preview") : f.elements.preview,
                    h = (f.multiple ? this.$file(e) : this.$el).find(g && g.el);
                h.length && b.getInfo(c, n(this, function(e, i) {
                    if (e) this.emit("previewError", [e, c]);
                    else {
                        h.find("div>div").length || h.html(a("<div><div></div></div>").css(g).css("overflow", "hidden")), this.__cropFile !== c && (this.__cropFile = c, b.Image(c).rotate(f.imageAutoOrientation ? "auto" : 0).get(function(b, c) {
                            h.find(">div>div").html(a(c).width("100%").height("100%"))
                        }, "exactFit"));
                        var j = g.width,
                            k = g.height,
                            l = j,
                            m = k,
                            n = j / d.rw,
                            o = k / d.rh;
                        g.keepAspectRatio && (n > 1 && o > 1 ? (n = o = 1, m = d.h, l = d.w) : o > n ? (o = n, m = j * d.rh / d.rw) : (n = o, l = k * d.rw / d.rh)), h.find(">div>div").css({
                            width: Math.round(n * i[d.flip ? "height" : "width"]),
                            height: Math.round(o * i[d.flip ? "width" : "height"]),
                            marginLeft: -Math.round(n * d.rx),
                            marginTop: -Math.round(o * d.ry)
                        }), g.keepAspectRatio && h.find(">div").css({
                            width: Math.round(l),
                            height: Math.round(m),
                            marginLeft: j > l ? Math.round((j - l) / 2) : 0,
                            marginTop: k > m ? Math.round((k - m) / 2) : 0
                        })
                    }
                })), this._crop[e] = d
            },
            resize: function(a, c, d, e) {
                this._resize[b.uid(a)] = {
                    type: e,
                    width: c,
                    height: d
                }
            },
            rotate: function(c, d) {
                var e = "string" == a.type(c) ? c : b.uid(c),
                    f = this.options,
                    g = f.multiple ? this.option("elements.file.preview") : f.elements.preview,
                    h = (f.multiple ? this.$file(e) : this.$el).find(g && g.el),
                    i = this._rotate;
                i[e] = /([+-])=/.test(d) ? d = (i[e] || 0) + ("+" == RegExp.$1 ? 1 : -1) * d.substr(2) : d, this._getFile(e).rotate = d, h.css({
                    "-webkit-transform": "rotate(" + d + "deg)",
                    "-moz-transform": "rotate(" + d + "deg)",
                    transform: "rotate(" + d + "deg)"
                })
            },
            remove: function(a) {
                var c = "object" == typeof a ? b.uid(a) : a;
                this.$file(c).remove(), this.queue = b.filter(this.queue, function(a) {
                    return b.uid(a) != c
                }), this.files = b.filter(this.files, function(a) {
                    return b.uid(a) != c
                }), this._redraw()
            },
            clear: function(a) {
                this._crop = {}, this._resize = {}, this._rotate = {}, this.queue = [], this.files = [], this.uploaded = [], this._redraw(void 0 === a ? !0 : a)
            },
            dequeue: function() {
                this.queue = [], this._redraw()
            },
            widget: function() {
                return this
            },
            toString: function() {
                return "[jQuery.FileAPI object]"
            },
            destroy: function() {
                this.$files.empty().append(this.$fileTpl), this.$el.off(".fileapi").removeData("fileapi"), l(this.options.elements.ctrl, function(b) {
                    p(b) && a(b).off("click.fileapi")
                })
            }
        }, a.fn.fileapi = function(b, c) {
            var d = this.data("fileapi");
            if (d) {
                if ("widget" === b) return d;
                if ("string" == typeof b) {
                    var e, f = d[b];
                    return a.isFunction(f) ? e = f.apply(d, k.call(arguments, 1)) : void 0 === f ? e = d.option(b, c) : "files" === b && (e = f), void 0 === e ? this : e
                }
            } else(null == b || "object" == typeof b) && this.data("fileapi", new q(this, b));
            return this
        }, a.fn.fileapi.version = "0.4.3", a.fn.fileapi.tpl = function(a) {
            var b = 0,
                c = "__b+='";
            return a.replace(/(?:&lt;|<)%([-=])?([\s\S]+?)%(?:&gt;|>)|$/g, function(d, e, f, g) {
                return c += a.slice(b, g).replace(/[\r\n"']/g, function(a) {
                    return "\\" + a
                }), f && (c += e ? "'+\n((__x=(" + f + "))==null?'':" + ("-" == e ? "__esc(__x)" : "__x") + ")\n+'" : "';\n" + f + "\n__b+='"), b = g + d.length, d
            }), new Function("ctx", "var __x,__b='',__esc=function(val){return typeof val=='string'?val.replace(/</g,'&lt;').replace(/\"/g,'&quot;'):val;};with(ctx||{}){\n" + c + "';\n}return __b;")
        }, a.fn.webcam = function(c) {
            var d = this,
                e = d,
                g = a(d),
                h = "fileapi-camera",
                i = g.data(h);
            return i === !0 ? (b.log("[webcam.warn] not ready."), e = null) : "widget" === c ? e = i : "destroy" === c ? (i.stop(), g.empty()) : i ? e = i[c]() : i === !1 ? (b.log("[webcam.error] does not work."), e = null) : (g.data(h, !0), c = m({
                success: f,
                error: f
            }, c), FileAPI.Camera.publish(g, c, function(a, b) {
                g.data(h, a ? !1 : b), c[a ? "error" : "success"].call(d, a || b)
            })), e
        }, a.fn.cropper = function(c) {
            var d = this,
                e = c.file;
            if ("string" == typeof c) d.first().Jcrop.apply(d, arguments);
            else {
                var f = c.minSize || [0, 0],
                    g = c.aspectRatio || f[0] / f[1];
                a.isArray(c.minSize) && void 0 === c.aspectRatio && g > 0 && (c.aspectRatio = g), b.getInfo(e, function(h, i) {
                    var j = b.Image(e),
                        k = c.maxSize,
                        m = e.rotate;
                    k && j.resize(Math.max(k[0], f[0]), Math.max(k[1], f[1]), "max"), j.rotate(void 0 === m ? "auto" : m).get(function(b, e) {
                        var f = c.selection,
                            h = Math.min(e.width, e.height),
                            j = h,
                            k = h / g,
                            m = FileAPI.Image.exifOrientation[i.exif && i.exif.Orientation] || 0;
                        if (f) {
                            (/%/.test(f) || f > 0 && 1 > f) && (f = parseFloat(f, 10) / (f > 0 ? 1 : 100), j *= f, k *= f);
                            var n = (e.width - j) / 2,
                                o = (e.height - k) / 2;
                            c.setSelect = [0 | n, 0 | o, n + j | 0, o + k | 0]
                        }
                        l(["onSelect", "onChange"], function(a, b) {
                            (b = c[a]) && (c[a] = function(a) {
                                var c = m % 180,
                                    d = i.width,
                                    f = i.height,
                                    g = a.x / e.width,
                                    h = a.y / e.height,
                                    j = a.w / e.width,
                                    k = a.h / e.height,
                                    l = d * (c ? h : g),
                                    n = f * (c ? 1 - (a.x + a.w) / e.width : h),
                                    o = d * (c ? k : j),
                                    p = f * (c ? j : k);
                                b({
                                    x: l,
                                    y: n,
                                    w: o,
                                    h: p,
                                    rx: g * (c ? f : d),
                                    ry: h * (c ? d : f),
                                    rw: j * (c ? f : d),
                                    rh: k * (c ? d : f),
                                    lx: a.x,
                                    ly: a.y,
                                    lw: a.w,
                                    lh: a.h,
                                    lx2: a.x2,
                                    ly2: a.y2,
                                    deg: m,
                                    flip: c
                                })
                            })
                        });
                        var p = a("<div/>").css("lineHeight", 0).append(a(e).css("margin", 0));
                        d.html(p), p.Jcrop(c).trigger("resize")
                    })
                })
            }
            return d
        }
    }(jQuery, FileAPI);